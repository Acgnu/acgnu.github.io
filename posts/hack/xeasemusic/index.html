<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="背景 某抑云音乐随着版本更新, 加入了越来越多的垃圾功能和广告, 严重影响体验, 而且在歌单播放按钮上添加了购买VIP按钮, 不仅比播放按钮大, 还是延迟显示的, 非常容易误按, 就很生气, 于是决定干掉它们
目标 精简某易云UI, 只留下自己需要的部分, 同时各个地方的广告和更新提示
受害者版本 V7.2.10.782837
APP界面概览  image-1 
开始破解 直接用反编译工具Jadx, 打开安装包即.apk, 发现软件没有加壳, 可以顺利反编译出源码, 直接按 Ctrl + S 将源码全部保存, 然后导入IDEA, 开始分析代码
 虽然没有加壳, 但是经过了混淆, 阅读性非常差, 而且绝大部分字符串都经过了加密, 无法直接搜索, 可以说是非常猥琐了
  image-2 
1.去除多余标签 首先去除本人用不上的标签页, 只需要留下&amp;quot;我的&amp;quot;标签页就行
 image-3 
首先全局搜索文字&amp;quot;我的&amp;quot;
 image-4 
发现能够完全匹配标签栏四组文字的, 在一个arrays.xml文本里, 其中节点的name为ap, 于是搜索R.array.ap
 image-5 
可以发现一处搜索结果, 位于MainActivity, 应该就是需要找的目标了, 看看这个b方法的实现
 image-6 
发现此方法只是把xml里的数组保存, 那么我只需要把这个入参的值修改一下, 应该就可以实现去除多余标签的作用了, 编写xposed模块代码如下"><title>某抑云音乐破解简化UI去广告去更新</title><link rel=canonical href=/posts/hack/xeasemusic/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="某抑云音乐破解简化UI去广告去更新"><meta property="og:description" content="背景 某抑云音乐随着版本更新, 加入了越来越多的垃圾功能和广告, 严重影响体验, 而且在歌单播放按钮上添加了购买VIP按钮, 不仅比播放按钮大, 还是延迟显示的, 非常容易误按, 就很生气, 于是决定干掉它们
目标 精简某易云UI, 只留下自己需要的部分, 同时各个地方的广告和更新提示
受害者版本 V7.2.10.782837
APP界面概览  image-1 
开始破解 直接用反编译工具Jadx, 打开安装包即.apk, 发现软件没有加壳, 可以顺利反编译出源码, 直接按 Ctrl + S 将源码全部保存, 然后导入IDEA, 开始分析代码
 虽然没有加壳, 但是经过了混淆, 阅读性非常差, 而且绝大部分字符串都经过了加密, 无法直接搜索, 可以说是非常猥琐了
  image-2 
1.去除多余标签 首先去除本人用不上的标签页, 只需要留下&amp;quot;我的&amp;quot;标签页就行
 image-3 
首先全局搜索文字&amp;quot;我的&amp;quot;
 image-4 
发现能够完全匹配标签栏四组文字的, 在一个arrays.xml文本里, 其中节点的name为ap, 于是搜索R.array.ap
 image-5 
可以发现一处搜索结果, 位于MainActivity, 应该就是需要找的目标了, 看看这个b方法的实现
 image-6 
发现此方法只是把xml里的数组保存, 那么我只需要把这个入参的值修改一下, 应该就可以实现去除多余标签的作用了, 编写xposed模块代码如下"><meta property="og:url" content="/posts/hack/xeasemusic/"><meta property="og:site_name" content="Acgnu+"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="Hack"><meta property="article:tag" content="Android"><meta property="article:tag" content="Xposed"><meta property="article:published_time" content="2021-11-09T00:50:44+08:00"><meta property="article:modified_time" content="2021-11-09T00:50:44+08:00"><meta property="og:image" content="/posts/hack/xeasemusic/cover.png"><meta name=twitter:title content="某抑云音乐破解简化UI去广告去更新"><meta name=twitter:description content="背景 某抑云音乐随着版本更新, 加入了越来越多的垃圾功能和广告, 严重影响体验, 而且在歌单播放按钮上添加了购买VIP按钮, 不仅比播放按钮大, 还是延迟显示的, 非常容易误按, 就很生气, 于是决定干掉它们
目标 精简某易云UI, 只留下自己需要的部分, 同时各个地方的广告和更新提示
受害者版本 V7.2.10.782837
APP界面概览  image-1 
开始破解 直接用反编译工具Jadx, 打开安装包即.apk, 发现软件没有加壳, 可以顺利反编译出源码, 直接按 Ctrl + S 将源码全部保存, 然后导入IDEA, 开始分析代码
 虽然没有加壳, 但是经过了混淆, 阅读性非常差, 而且绝大部分字符串都经过了加密, 无法直接搜索, 可以说是非常猥琐了
  image-2 
1.去除多余标签 首先去除本人用不上的标签页, 只需要留下&amp;quot;我的&amp;quot;标签页就行
 image-3 
首先全局搜索文字&amp;quot;我的&amp;quot;
 image-4 
发现能够完全匹配标签栏四组文字的, 在一个arrays.xml文本里, 其中节点的name为ap, 于是搜索R.array.ap
 image-5 
可以发现一处搜索结果, 位于MainActivity, 应该就是需要找的目标了, 看看这个b方法的实现
 image-6 
发现此方法只是把xml里的数组保存, 那么我只需要把这个入参的值修改一下, 应该就可以实现去除多余标签的作用了, 编写xposed模块代码如下"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/posts/hack/xeasemusic/cover.png"><link rel="shortcut icon" href=/favicon.ico></head><body class="article-page keep-sidebar"><script>(function(){const colorSchemeKey='StackColorScheme';if(!localStorage.getItem(colorSchemeKey)){localStorage.setItem(colorSchemeKey,"auto");}})();</script><script>(function(){const colorSchemeKey='StackColorScheme';const colorSchemeItem=localStorage.getItem(colorSchemeKey);const supportDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches===true;if(colorSchemeItem=='dark'||colorSchemeItem==='auto'&&supportDarkMode){document.body.dataset.scheme='dark';}else{document.body.dataset.scheme='light';}})();</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu3a9833e4ebdcf9e444b7caf140fa72b8_113624_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>😎</span></figure><h1 class=site-name><a href=/>Acgnu+</a></h1><h2 class=site-description>時間はいつも足りない</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/hack/xeasemusic/><img src=/posts/hack/xeasemusic/cover_hu18a0dfe24013f6b0b7ee4adfea89b908_697188_800x0_resize_box_2.png srcset="/posts/hack/xeasemusic/cover_hu18a0dfe24013f6b0b7ee4adfea89b908_697188_800x0_resize_box_2.png 800w, /posts/hack/xeasemusic/cover_hu18a0dfe24013f6b0b7ee4adfea89b908_697188_1600x0_resize_box_2.png 1600w" width=800 height=476 loading=lazy alt="Featured image of post 某抑云音乐破解简化UI去广告去更新"></a></div><div class=article-details><header class=article-category><a href=/categories/hack/>Hack</a></header><h2 class=article-title><a href=/posts/hack/xeasemusic/>某抑云音乐破解简化UI去广告去更新</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Nov 09, 2021</time></footer></div></header><section class=article-content><h2 id=背景>背景</h2><p>某抑云音乐随着版本更新, 加入了越来越多的垃圾功能和广告, 严重影响体验, 而且在歌单播放按钮上添加了购买VIP按钮, 不仅比播放按钮大, 还是延迟显示的, 非常容易误按, 就很生气, 于是决定干掉它们</p><h2 id=目标>目标</h2><p>精简某易云UI, 只留下自己需要的部分, 同时各个地方的广告和更新提示</p><h2 id=受害者版本>受害者版本</h2><p>V7.2.10.782837</p><h2 id=app界面概览>APP界面概览</h2><p><figure style=flex-grow:173;flex-basis:417px><a href=/posts/hack/xeasemusic/1.jpg data-size=1000x575><img src=/posts/hack/xeasemusic/1.jpg srcset="/posts/hack/xeasemusic/1_hu394211d721ec1e75a700144baf4ad841_84090_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/1_hu394211d721ec1e75a700144baf4ad841_84090_1024x0_resize_q75_box.jpg 1024w" width=1000 height=575 loading=lazy alt=image-1></a><figcaption>image-1</figcaption></figure></p><h2 id=开始破解>开始破解</h2><p>直接用反编译工具<a class=link href=https://github.com/skylot/jadx target=_blank rel=noopener>Jadx</a>, 打开安装包即<code>.apk</code>, 发现软件没有加壳, 可以顺利反编译出源码, 直接按 <code>Ctrl + S</code> 将源码全部保存, 然后导入<code>IDEA</code>, 开始分析代码</p><blockquote><p>虽然没有加壳, 但是经过了混淆, 阅读性非常差, 而且绝大部分字符串都经过了加密, 无法直接搜索, 可以说是非常猥琐了</p></blockquote><p><figure style=flex-grow:148;flex-basis:357px><a href=/posts/hack/xeasemusic/2.jpg data-size=892x599><img src=/posts/hack/xeasemusic/2.jpg srcset="/posts/hack/xeasemusic/2_hu0089b3dbce7d597175082fa79a450d13_52285_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/2_hu0089b3dbce7d597175082fa79a450d13_52285_1024x0_resize_q75_box.jpg 1024w" width=892 height=599 loading=lazy alt=image-2></a><figcaption>image-2</figcaption></figure></p><h2 id=1去除多余标签>1.去除多余标签</h2><p>首先去除本人用不上的标签页, 只需要留下"我的"标签页就行</p><p><figure style=flex-grow:316;flex-basis:759px><a href=/posts/hack/xeasemusic/3.jpg data-size=462x146><img src=/posts/hack/xeasemusic/3.jpg srcset="/posts/hack/xeasemusic/3_hu406b6e60d83a327970afdc698b27c2a9_7407_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/3_hu406b6e60d83a327970afdc698b27c2a9_7407_1024x0_resize_q75_box.jpg 1024w" width=462 height=146 loading=lazy alt=image-3></a><figcaption>image-3</figcaption></figure></p><p>首先全局搜索文字"我的"</p><p><figure style=flex-grow:141;flex-basis:339px><a href=/posts/hack/xeasemusic/4.jpg data-size=641x453><img src=/posts/hack/xeasemusic/4.jpg srcset="/posts/hack/xeasemusic/4_hu9caf4385ce48b002b831ac272cd33a9e_25881_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/4_hu9caf4385ce48b002b831ac272cd33a9e_25881_1024x0_resize_q75_box.jpg 1024w" width=641 height=453 loading=lazy alt=image-4></a><figcaption>image-4</figcaption></figure></p><p>发现能够完全匹配标签栏四组文字的, 在一个<code>arrays.xml</code>文本里, 其中节点的<code>name</code>为<code>ap</code>, 于是搜索<code>R.array.ap</code></p><p><figure style=flex-grow:168;flex-basis:404px><a href=/posts/hack/xeasemusic/5.jpg data-size=650x386><img src=/posts/hack/xeasemusic/5.jpg srcset="/posts/hack/xeasemusic/5_hufa6fa374304e0e6fc4f95f0a44dcc12d_32751_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/5_hufa6fa374304e0e6fc4f95f0a44dcc12d_32751_1024x0_resize_q75_box.jpg 1024w" width=650 height=386 loading=lazy alt=image-5></a><figcaption>image-5</figcaption></figure></p><p>可以发现一处搜索结果, 位于<code>MainActivity</code>, 应该就是需要找的目标了, 看看这个<code>b</code>方法的实现</p><p><figure style=flex-grow:371;flex-basis:891px><a href=/posts/hack/xeasemusic/6.jpg data-size=297x80><img src=/posts/hack/xeasemusic/6.jpg srcset="/posts/hack/xeasemusic/6_hubcf35791e8005caf432b6c4d673f5320_3500_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/6_hubcf35791e8005caf432b6c4d673f5320_3500_1024x0_resize_q75_box.jpg 1024w" width=297 height=80 loading=lazy alt=image-6></a><figcaption>image-6</figcaption></figure></p><p><strong>发现此方法只是把<code>xml</code>里的数组保存, 那么我只需要把这个入参的值修改一下, 应该就可以实现去除多余标签的作用了</strong>, 编写<code>xposed</code>模块代码如下</p><pre><code>findAndHookMethod(
    &quot;com.马赛克ease.马赛克music.activity.r&quot;, 
    loadPackageParam.classLoader, 
    &quot;b&quot;,
    String[].class,
    new XC_MethodHook() {
        @Override
        protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
            param.args[0] = new String[]{&quot;我的&quot;};
        }
    }
);
</code></pre><p>此代码将在<code>b</code>方法执行前执行, 将原本带有4个节点的数组重新赋值为只有一个的数组, 实际执行效果如下</p><p><figure style=flex-grow:385;flex-basis:926px><a href=/posts/hack/xeasemusic/7.jpg data-size=548x142><img src=/posts/hack/xeasemusic/7.jpg srcset="/posts/hack/xeasemusic/7_hu76efc633ffd4f100cda63de540a6c11c_5217_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/7_hu76efc633ffd4f100cda63de540a6c11c_5217_1024x0_resize_q75_box.jpg 1024w" width=548 height=142 loading=lazy alt=image-7></a><figcaption>image-7</figcaption></figure></p><p>可以看到除了"我的"以外的标签, 其他的都已经不再显示了</p><h2 id=2去除用户vip信息>2.去除用户VIP信息</h2><p>用户VIP信息如下, 纯属占位置又无用的一块节点</p><p><figure style=flex-grow:240;flex-basis:576px><a href=/posts/hack/xeasemusic/8.jpg data-size=389x162><img src=/posts/hack/xeasemusic/8.jpg srcset="/posts/hack/xeasemusic/8_hu3c8b24f48ba4b556a63204eb0d0c716b_7178_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/8_hu3c8b24f48ba4b556a63204eb0d0c716b_7178_1024x0_resize_q75_box.jpg 1024w" width=389 height=162 loading=lazy alt=image-8></a><figcaption>image-8</figcaption></figure></p><p>首先在<a class=link href=https://developer.android.google.cn/studio/profile/monitor target=_blank rel=noopener>Android Device Monitor</a>查看一下VIP信息中头像节点的父节点<code>id</code></p><p><figure style=flex-grow:292;flex-basis:701px><a href=/posts/hack/xeasemusic/12.jpg data-size=1216x416><img src=/posts/hack/xeasemusic/12.jpg srcset="/posts/hack/xeasemusic/12_hu0c1a689cde821f071fb93ef8ea2299de_61354_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/12_hu0c1a689cde821f071fb93ef8ea2299de_61354_1024x0_resize_q75_box.jpg 1024w" width=1216 height=416 loading=lazy alt=image-12></a><figcaption>image-12</figcaption></figure></p><p>可以看到<code>id</code>为<code>headerMyInfo</code>, 在源码中全局搜索<code>headerMyInfo</code>, 找到<code>HeaderEntryListViewHolder</code>中有一处实际调用</p><p><figure style=flex-grow:169;flex-basis:407px><a href=/posts/hack/xeasemusic/11.jpg data-size=665x392><img src=/posts/hack/xeasemusic/11.jpg srcset="/posts/hack/xeasemusic/11_hu832e869c1f67da6028994494a950c04c_45118_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/11_hu832e869c1f67da6028994494a950c04c_45118_1024x0_resize_q75_box.jpg 1024w" width=665 height=392 loading=lazy alt=image-11></a><figcaption>image-11</figcaption></figure></p><p><strong>此处将<code>headerMyInfo</code>的<code>view</code>传入<code>MyVipInfoViewHolder</code>作为参数, 之后创建了<code>MyVipInfoViewHolder</code>, 因此只需要修改一下传入的<code>headerMyInfo</code>布局参数, 即可隐藏这个节点</strong>, 编写<code>xposed</code>代码如下:</p><pre><code>findAndHookConstructor(
    &quot;com.马赛克ease.马赛克music.module.mymusic.headerentry.MyVipInfoViewHolder&quot;, loadPackageParam.classLoader,
    View.class,
    &quot;com.马赛克ease.马赛克music.module.mymusic.k&quot;,
    new XC_MethodHook() {
        @Override
        protected void afterHookedMethod(MethodHookParam param) throws Throwable {
            View view = (View) param.args[0];
            view.setVisibility(View.GONE);
        }
    }
)
</code></pre><p>此代码拦截<code>MyVipInfoViewHolder</code>的构造函数, 并将传入的参数<code>headerMyInfo</code>修改显示方式为<code>View.GONE</code>, 以达到隐藏的目的. 编写完后运行结果如下, 可以看到VIP节点已经成功隐藏</p><blockquote><p>注: 一个界面节点在创建之后可能会被多次调用, 直接删除节点可能会引起报错, 因为隐藏节点最为妥当</p></blockquote><p><figure style=flex-grow:216;flex-basis:520px><a href=/posts/hack/xeasemusic/13.jpg data-size=375x173><img src=/posts/hack/xeasemusic/13.jpg srcset="/posts/hack/xeasemusic/13_hu0695848f27144fc461faaa8c0baacc9f_3905_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/13_hu0695848f27144fc461faaa8c0baacc9f_3905_1024x0_resize_q75_box.jpg 1024w" width=375 height=173 loading=lazy alt=image-13></a><figcaption>image-13</figcaption></figure></p><h2 id=3隐藏小程序标题以及小程序列表>3.隐藏小程序标题以及小程序列表</h2><p>此处小程序列表本人也是从来不用, 而其所占位置之大令人发指</p><p><figure style=flex-grow:137;flex-basis:330px><a href=/posts/hack/xeasemusic/14.jpg data-size=368x267><img src=/posts/hack/xeasemusic/14.jpg srcset="/posts/hack/xeasemusic/14_hu5ca81e96b348e5ca80fafffff0e83929_13108_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/14_hu5ca81e96b348e5ca80fafffff0e83929_13108_1024x0_resize_q75_box.jpg 1024w" width=368 height=267 loading=lazy alt=image-14></a><figcaption>image-14</figcaption></figure></p><p>在<a class=link href=https://developer.android.google.cn/studio/profile/monitor target=_blank rel=noopener>Android Device Monitor</a>中看到标题节点的父节点<code>id</code>为<code>miniAppListSection</code></p><p><figure style=flex-grow:343;flex-basis:825px><a href=/posts/hack/xeasemusic/17.jpg data-size=1169x340><img src=/posts/hack/xeasemusic/17.jpg srcset="/posts/hack/xeasemusic/17_hu7de6e24118f7a4c3d6f38753608cd1d4_54708_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/17_hu7de6e24118f7a4c3d6f38753608cd1d4_54708_1024x0_resize_q75_box.jpg 1024w" width=1169 height=340 loading=lazy alt=image-17></a><figcaption>image-17</figcaption></figure></p><p>搜索这个<code>id</code></p><p><figure style=flex-grow:161;flex-basis:387px><a href=/posts/hack/xeasemusic/15.jpg data-size=645x399><img src=/posts/hack/xeasemusic/15.jpg srcset="/posts/hack/xeasemusic/15_hu1a128ee9791f0657a00d6c1cec64d39d_46174_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/15_hu1a128ee9791f0657a00d6c1cec64d39d_46174_1024x0_resize_q75_box.jpg 1024w" width=645 height=399 loading=lazy alt=image-15></a><figcaption>image-15</figcaption></figure></p><p>发现其在<code>SimpleSectionViewHolder</code>的构造函数中被调用, 该构造函数代码如下</p><p><figure style=flex-grow:418;flex-basis:1003px><a href=/posts/hack/xeasemusic/16.jpg data-size=393x94><img src=/posts/hack/xeasemusic/16.jpg srcset="/posts/hack/xeasemusic/16_hubad3e495962fbe1d107e61b82a970315_6020_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/16_hubad3e495962fbe1d107e61b82a970315_6020_1024x0_resize_q75_box.jpg 1024w" width=393 height=94 loading=lazy alt=image-16></a><figcaption>image-16</figcaption></figure></p><p>可以看出这里和刚才的VIP信息代码几乎一致, 因此可以采用刚才的方式进行隐藏, 但不同的是<code>SimpleSectionViewHolder</code>这个类有多处调用</p><p><figure style=flex-grow:424;flex-basis:1019px><a href=/posts/hack/xeasemusic/18.jpg data-size=603x142><img src=/posts/hack/xeasemusic/18.jpg srcset="/posts/hack/xeasemusic/18_huaaf2c9083ce854493f125c511512c4bb_16409_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/18_huaaf2c9083ce854493f125c511512c4bb_16409_1024x0_resize_q75_box.jpg 1024w" width=603 height=142 loading=lazy alt=image-18></a><figcaption>image-18</figcaption></figure></p><p><strong>为了保证我们隐藏的<code>view</code>参数是小程序的标题, 因此需要查看一下传入<code>miniAppListSection</code>节点的资源<code>id</code></strong></p><blockquote><p>资源<code>id</code>是安卓应用在编译后对应每个节点生成的唯一<code>id</code>, 在编译期间可以使用<code>R.id</code>/<code>R.array</code>/<code>R.layout</code>等其实都是引用了这个<code>id</code>, 在编译后会生成在<code>R.java</code>中, 还有一个<code>public.xml</code>中存在一个同样的值与之对应</p></blockquote><p>点击调用<code>SimpleSectionViewHolder</code>构造函数中参数<code>R.id.miniAppListSection</code>可以跳转到<code>R.java</code>, <strong>此时看到的资源<code>id</code>为<code>2131299470</code></strong></p><p><figure style=flex-grow:992;flex-basis:2381px><a href=/posts/hack/xeasemusic/19.jpg data-size=387x39><img src=/posts/hack/xeasemusic/19.jpg srcset="/posts/hack/xeasemusic/19_hu19c3c30341cb02fc2539b98fb2cb0e45_4174_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/19_hu19c3c30341cb02fc2539b98fb2cb0e45_4174_1024x0_resize_q75_box.jpg 1024w" width=387 height=39 loading=lazy alt=image-19></a><figcaption>image-19</figcaption></figure></p><p>现在可以编写<code>xposed</code>代码如下</p><pre><code>findAndHookConstructor(
    &quot;com.马赛克ease.马赛克music.module.mymusic.SimpleSectionViewHolder&quot;, loadPackageParam.classLoader,
    View.class,
    &quot;com.马赛克ease.马赛克music.module.mymusic.k&quot;,
    new XC_MethodHook() {
        @Override
        protected void afterHookedMethod(MethodHookParam param) throws Throwable {
            RelativeLayout layout = (RelativeLayout) param.args[0];
            if (layout.getId() == 2131299470) {
                layout.setVisibility(View.GONE);
            }
        }
    }
);
</code></pre><p>这里拦截<code>SimpleSectionViewHolder</code>的构造函数, 当资源节点的<code>id</code>为<code>2131299470</code>时, 将节点隐藏</p><p>继续寻找小程序卡片的布局, 这里卡片节点没有合适的节点<code>id</code>用于搜索, 因此找到他的父节点<code>id</code>为<code>myMusicRecyclerView</code></p><p><figure style=flex-grow:227;flex-basis:547px><a href=/posts/hack/xeasemusic/20.jpg data-size=1224x537><img src=/posts/hack/xeasemusic/20.jpg srcset="/posts/hack/xeasemusic/20_hu6f26467958821e7a80072ee8126fa0f6_88317_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/20_hu6f26467958821e7a80072ee8126fa0f6_88317_1024x0_resize_q75_box.jpg 1024w" width=1224 height=537 loading=lazy alt=image-20></a><figcaption>image-20</figcaption></figure></p><p>全局搜索<code>myMusicRecyclerView</code>, 得到多处结果, <strong>但位于<code>com.马赛克ease.马赛克music.module.mymusic.k</code>中因为使用到了类<code>MiniAppListLinearViewHolder</code>, 根据名称推测<code>MiniAppListLinearViewHolder</code>应该是用于创建卡片父节点列表的</strong></p><p><figure style=flex-grow:106;flex-basis:256px><a href=/posts/hack/xeasemusic/21.jpg data-size=642x601><img src=/posts/hack/xeasemusic/21.jpg srcset="/posts/hack/xeasemusic/21_hud3841ee369b293e4fcd2b0e740582ef5_81633_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/21_hud3841ee369b293e4fcd2b0e740582ef5_81633_1024x0_resize_q75_box.jpg 1024w" width=642 height=601 loading=lazy alt=image-21></a><figcaption>image-21</figcaption></figure></p><p>其中<code>bindType</code>调用了<code>MiniAppListLinearViewHolder.a()</code>, <strong>跳转进去可以看到内部调用了构造函数</strong></p><p><figure style=flex-grow:317;flex-basis:762px><a href=/posts/hack/xeasemusic/23.jpg data-size=788x248><img src=/posts/hack/xeasemusic/23.jpg srcset="/posts/hack/xeasemusic/23_hueb1128d6c6eb0ca2b720c46bdf53de21_27859_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/23_hueb1128d6c6eb0ca2b720c46bdf53de21_27859_1024x0_resize_q75_box.jpg 1024w" width=788 height=248 loading=lazy alt=image-23></a><figcaption>image-23</figcaption></figure></p><p>看一眼<code>MiniAppListLinearViewHolder</code>的构造函数代码</p><p><figure style=flex-grow:380;flex-basis:913px><a href=/posts/hack/xeasemusic/22.jpg data-size=514x135><img src=/posts/hack/xeasemusic/22.jpg srcset="/posts/hack/xeasemusic/22_huf74679e539d3245467a8975b6f5f594e_11770_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/22_huf74679e539d3245467a8975b6f5f594e_11770_1024x0_resize_q75_box.jpg 1024w" width=514 height=135 loading=lazy alt=image-22></a><figcaption>image-22</figcaption></figure></p><p>实现也非常简单, 推测可以使用刚才的方式将隐藏, 编写<code>xposed</code>代码如下:</p><pre><code>findAndHookConstructor(
    &quot;com.马赛克ease.马赛克music.module.mymusic.miniapp.linear.MiniAppListLinearViewHolder&quot;, loadPackageParam.classLoader,
    View.class,
    &quot;com.马赛克ease.马赛克music.module.mymusic.k&quot;,
    int.class,
    int.class,
    new XC_MethodHook() {
        @Override
        protected void afterHookedMethod(MethodHookParam param) throws Throwable {
            View miniAppListView = (View) param.args[0];
            ViewGroup.LayoutParams layoutParams = miniAppListView.getLayoutParams();
            layoutParams.height = 0;
        }
    }
);
</code></pre><p>这里拦截<code>MiniAppListLinearViewHolder</code>的构造函数, 并将布局高度改为0, 达到隐藏的目的, 运行效果如下</p><p><figure style=flex-grow:212;flex-basis:511px><a href=/posts/hack/xeasemusic/25.jpg data-size=313x147><img src=/posts/hack/xeasemusic/25.jpg srcset="/posts/hack/xeasemusic/25_hu8332141b9c0de66db381fde3d6b1b944_6333_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/25_hu8332141b9c0de66db381fde3d6b1b944_6333_1024x0_resize_q75_box.jpg 1024w" width=313 height=147 loading=lazy alt=image-25></a><figcaption>image-25</figcaption></figure></p><p>在隐藏了这么多节点之后, 布局出现了一点问题</p><p><figure style=flex-grow:167;flex-basis:402px><a href=/posts/hack/xeasemusic/26.jpg data-size=544x324><img src=/posts/hack/xeasemusic/26.jpg srcset="/posts/hack/xeasemusic/26_hu233a6adfa9ef11599db90c0c279167f9_10234_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/26_hu233a6adfa9ef11599db90c0c279167f9_10234_1024x0_resize_q75_box.jpg 1024w" width=544 height=324 loading=lazy alt=image-26></a><figcaption>image-26</figcaption></figure></p><p>可以看到"本地音乐"这一栏的按钮偏下了, 需要调整一下位置. 首先查看一下这一栏按钮父节点<code>id</code></p><p><figure style=flex-grow:254;flex-basis:609px><a href=/posts/hack/xeasemusic/27.jpg data-size=1123x442><img src=/posts/hack/xeasemusic/27.jpg srcset="/posts/hack/xeasemusic/27_hu1fa50c1c6e036cca9d008cdb718b15a0_67341_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/27_hu1fa50c1c6e036cca9d008cdb718b15a0_67341_1024x0_resize_q75_box.jpg 1024w" width=1123 height=442 loading=lazy alt=image-27></a><figcaption>image-27</figcaption></figure></p><p>可以看到父节点<code>id</code>为<code>centerContainer</code>, 全局搜索后可以找到一处调用</p><p><figure style=flex-grow:124;flex-basis:299px><a href=/posts/hack/xeasemusic/28.jpg data-size=650x521><img src=/posts/hack/xeasemusic/28.jpg srcset="/posts/hack/xeasemusic/28_huc5e658d31af1f3bc559b839b22a97849_53411_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/28_huc5e658d31af1f3bc559b839b22a97849_53411_1024x0_resize_q75_box.jpg 1024w" width=650 height=521 loading=lazy alt=image-28></a><figcaption>image-28</figcaption></figure></p><p><strong>这个节点被赋值为成员变量<code>f15898e</code>, 而这个变量名是由反编译工具改名而来, 可以看到反编译提示原本变量名为<code>e</code></strong></p><p><figure style=flex-grow:677;flex-basis:1624px><a href=/posts/hack/xeasemusic/29.jpg data-size=501x74><img src=/posts/hack/xeasemusic/29.jpg srcset="/posts/hack/xeasemusic/29_hu14c4180027ad19686f63197c810992d3_5308_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/29_hu14c4180027ad19686f63197c810992d3_5308_1024x0_resize_q75_box.jpg 1024w" width=501 height=74 loading=lazy alt=image-29></a><figcaption>image-29</figcaption></figure></p><p>下面需要修改这个节点的布局参数, 编写<code>xposed</code>代码如下</p><pre><code>findAndHookConstructor(
    &quot;com.马赛克ease.马赛克music.module.mymusic.headerentry.HeaderEntryListViewHolder&quot;, loadPackageParam.classLoader,
    View.class,
    &quot;com.马赛克ease.马赛克music.module.mymusic.k&quot;,
    new XC_MethodHook() {
        @Override
        protected void afterHookedMethod(MethodHookParam param) throws Throwable {
            LinearLayout view = (LinearLayout) getObjectField(param.thisObject, &quot;e&quot;);
            FrameLayout.LayoutParams layoutParams = (FrameLayout.LayoutParams) view.getLayoutParams();
            layoutParams.bottomMargin = 50;
            layoutParams.gravity = Gravity.BOTTOM;
        }
    }
);
</code></pre><p>此处拦截赋值部分的方法, 在<code>HeaderEntryListViewHolder</code>的构造方法执行之后, 获取到成员变量<code>e</code>并修改其布局为<code>Gravity.BOTTOM</code>, 将节点靠底排列, <code>bottomMargin=50</code>, 距离底部50个边距, 编译后运行效果如下</p><p><figure style=flex-grow:109;flex-basis:262px><a href=/posts/hack/xeasemusic/30.jpg data-size=304x278><img src=/posts/hack/xeasemusic/30.jpg srcset="/posts/hack/xeasemusic/30_hu58f7ec5dbed2a5e311d503194b581b98_8743_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/30_hu58f7ec5dbed2a5e311d503194b581b98_8743_1024x0_resize_q75_box.jpg 1024w" width=304 height=278 loading=lazy alt=image-30></a><figcaption>image-30</figcaption></figure></p><p>可以看到按钮正常排列了</p><blockquote><p>按钮上方留白一段距离主要是为了设置背景的时候可以看到</p></blockquote><p>至此, 首页全部整改完毕, 完整效果图如下</p><p><figure style=flex-grow:49;flex-basis:117px><a href=/posts/hack/xeasemusic/31.jpg data-size=308x627><img src=/posts/hack/xeasemusic/31.jpg srcset="/posts/hack/xeasemusic/31_hu9b7acd5e3bb53edc812211b1adceecc9_21973_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/31_hu9b7acd5e3bb53edc812211b1adceecc9_21973_1024x0_resize_q75_box.jpg 1024w" width=308 height=627 loading=lazy alt=image-31></a><figcaption>image-31</figcaption></figure></p><h2 id=4去除播放列表顶部广告按钮>4.去除播放列表顶部广告按钮</h2><p>这个该死的广告按钮和播放按钮放一块非常容易误触</p><p><figure style=flex-grow:120;flex-basis:290px><a href=/posts/hack/xeasemusic/32.jpg data-size=370x306><img src=/posts/hack/xeasemusic/32.jpg srcset="/posts/hack/xeasemusic/32_hu08659f642f1645c8da8481d4193472c9_17738_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/32_hu08659f642f1645c8da8481d4193472c9_17738_1024x0_resize_q75_box.jpg 1024w" width=370 height=306 loading=lazy alt=image-32></a><figcaption>image-32</figcaption></figure></p><p>首先查看节点<code>id</code>, 得到<code>exposureGuideIcon</code></p><p><figure style=flex-grow:394;flex-basis:945px><a href=/posts/hack/xeasemusic/33.jpg data-size=1190x302><img src=/posts/hack/xeasemusic/33.jpg srcset="/posts/hack/xeasemusic/33_hu2b6f7c4011a2e048b3897d0ec08d26c5_48296_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/33_hu2b6f7c4011a2e048b3897d0ec08d26c5_48296_1024x0_resize_q75_box.jpg 1024w" width=1190 height=302 loading=lazy alt=image-33></a><figcaption>image-33</figcaption></figure></p><p>全局搜索, 发现在构造函数中有一处引用</p><p><figure style=flex-grow:127;flex-basis:305px><a href=/posts/hack/xeasemusic/34.jpg data-size=641x504><img src=/posts/hack/xeasemusic/34.jpg srcset="/posts/hack/xeasemusic/34_hu38cdb4460f6736c4127d1c61595aa739_45810_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/34_hu38cdb4460f6736c4127d1c61595aa739_45810_1024x0_resize_q75_box.jpg 1024w" width=641 height=504 loading=lazy alt=image-34></a><figcaption>image-34</figcaption></figure></p><p>通过搜索<code>new ExposureGuideView</code>查看实例被创建的地方, 找到两处, 但当前界面是播放列表, 因此关注<code>PlayListFragment</code></p><p><figure style=flex-grow:173;flex-basis:416px><a href=/posts/hack/xeasemusic/35.jpg data-size=877x505><img src=/posts/hack/xeasemusic/35.jpg srcset="/posts/hack/xeasemusic/35_hu558718252af24ad66769987c7a3947aa_48012_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/35_hu558718252af24ad66769987c7a3947aa_48012_1024x0_resize_q75_box.jpg 1024w" width=877 height=505 loading=lazy alt=image-35></a><figcaption>image-35</figcaption></figure></p><p>实例在<code>PlayListFragment</code>的<code>cl</code>方法中被创建, 查看一下<code>cl</code>的完整代码</p><p><figure style=flex-grow:104;flex-basis:249px><a href=/posts/hack/xeasemusic/36.jpg data-size=707x679><img src=/posts/hack/xeasemusic/36.jpg srcset="/posts/hack/xeasemusic/36_hu47f624dd0aba93576ea00791222c361a_54606_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/36_hu47f624dd0aba93576ea00791222c361a_54606_1024x0_resize_q75_box.jpg 1024w" width=707 height=679 loading=lazy alt=image-36></a><figcaption>image-36</figcaption></figure></p><p>初步分析基本上都是干的和广告相关的事, 因此直接拦截取缔这个方法, 编写<code>xposed</code>代码如下</p><pre><code>findAndHookMethod(
    &quot;com.马赛克ease.马赛克music.fragment.PlayListFragment&quot;, 
    loadPackageParam.classLoader, 
    &quot;cl&quot;, 
    new XC_MethodReplacement() {
        @Override
        protected Object replaceHookedMethod(MethodHookParam methodHookParam) throws Throwable {
            return null;
        }
    }
);
</code></pre><p>此处代码直接替换原有方法执行, 不做任何事, 之后运行效果如下</p><p><figure style=flex-grow:160;flex-basis:385px><a href=/posts/hack/xeasemusic/37.jpg data-size=535x333><img src=/posts/hack/xeasemusic/37.jpg srcset="/posts/hack/xeasemusic/37_hubf45c5b4a1a70a21657ac1a835f43ece_13167_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/37_hubf45c5b4a1a70a21657ac1a835f43ece_13167_1024x0_resize_q75_box.jpg 1024w" width=535 height=333 loading=lazy alt=image-37></a><figcaption>image-37</figcaption></figure></p><p>可以看到广告已经被移除了</p><h2 id=5去除开屏广告>5.去除开屏广告</h2><p>开屏广告非常烦人, 且严重影响启动速度, 必须移除</p><blockquote><p>以下修改均为2019年期间, 我也不记得当时具体是怎么找的了, 只能以现有结果大致推测</p></blockquote><p>首先从启动类入手, 查看<code>AndroidManifest.xml</code>, 找到<code>intent-filter</code>为<code>android.intent.category.LAUNCHER</code>的一项<code>Actvity</code>即为启动类, 这里为<code>LoadingActivity</code></p><p><figure style=flex-grow:321;flex-basis:771px><a href=/posts/hack/xeasemusic/38.jpg data-size=765x238><img src=/posts/hack/xeasemusic/38.jpg srcset="/posts/hack/xeasemusic/38_hud4fce15e6959bece632e25be2b6d88f0_31103_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/38_hud4fce15e6959bece632e25be2b6d88f0_31103_1024x0_resize_q75_box.jpg 1024w" width=765 height=238 loading=lazy alt=image-38></a><figcaption>image-38</figcaption></figure></p><p>查阅<code>LoadingActivity</code>的代码, 会发现其重写了<code>onActivityResult</code></p><p><figure style=flex-grow:238;flex-basis:572px><a href=/posts/hack/xeasemusic/39.jpg data-size=453x190><img src=/posts/hack/xeasemusic/39.jpg srcset="/posts/hack/xeasemusic/39_hu3a68a8189dc04981b9d1b247ad6c58e1_10309_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/39_hu3a68a8189dc04981b9d1b247ad6c58e1_10309_1024x0_resize_q75_box.jpg 1024w" width=453 height=190 loading=lazy alt=image-39></a><figcaption>image-39</figcaption></figure></p><p>接着深入查看一下<code>h</code>方法</p><p><figure style=flex-grow:132;flex-basis:317px><a href=/posts/hack/xeasemusic/40.jpg data-size=200x151><img src=/posts/hack/xeasemusic/40.jpg srcset="/posts/hack/xeasemusic/40_hue291cbe0877007806e7e8c4444a30946_4005_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/40_hue291cbe0877007806e7e8c4444a30946_4005_1024x0_resize_q75_box.jpg 1024w" width=200 height=151 loading=lazy alt=image-40></a><figcaption>image-40</figcaption></figure></p><p>再看看<code>i</code>方法</p><p><figure style=flex-grow:202;flex-basis:485px><a href=/posts/hack/xeasemusic/41.jpg data-size=615x304><img src=/posts/hack/xeasemusic/41.jpg srcset="/posts/hack/xeasemusic/41_hu440009b23bcc71c983ca2877fb9cac68_30177_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/41_hu440009b23bcc71c983ca2877fb9cac68_30177_1024x0_resize_q75_box.jpg 1024w" width=615 height=304 loading=lazy alt=image-41></a><figcaption>image-41</figcaption></figure></p><p><strong>这里出现了一个关键的类 <code>LoadingAdFragment</code>, 看名字就像是一个读取广告的, 点进去查看一下类的代码可以看到, 在<code>onCreate</code>的时候从<code>Bundle</code>里尝试读取<code>AdInfo</code></strong>, 这越看越像广告</p><p><figure style=flex-grow:160;flex-basis:385px><a href=/posts/hack/xeasemusic/44.jpg data-size=432x269><img src=/posts/hack/xeasemusic/44.jpg srcset="/posts/hack/xeasemusic/44_hue92639689ceb27d8dc11563d32b4fc4e_16869_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/44_hue92639689ceb27d8dc11563d32b4fc4e_16869_1024x0_resize_q75_box.jpg 1024w" width=432 height=269 loading=lazy alt=image-44></a><figcaption>image-44</figcaption></figure></p><p>那么看一下取的<code>key</code>名称, 也就是变量<code>f5823d</code>的值</p><p><figure style=flex-grow:293;flex-basis:705px><a href=/posts/hack/xeasemusic/43.jpg data-size=476x162><img src=/posts/hack/xeasemusic/43.jpg srcset="/posts/hack/xeasemusic/43_hu07b44b2ae8472fff98065399b87b3e1a_13397_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/43_hu07b44b2ae8472fff98065399b87b3e1a_13397_1024x0_resize_q75_box.jpg 1024w" width=476 height=162 loading=lazy alt=image-43></a><figcaption>image-43</figcaption></figure></p><p><strong>可以看到这个键的名称也是叫做<code>adInfo</code>, 那么根据<code>onCreate</code>里的代码来看,如果取不到<code>adInfo</code>, 那应该就不会展示广告了吧</strong>, 而<code>arguments</code>参数是从<code>getArguments()</code>方法中获取的, 点进去看一下这个方法的实现</p><p><figure style=flex-grow:206;flex-basis:495px><a href=/posts/hack/xeasemusic/45.jpg data-size=504x244><img src=/posts/hack/xeasemusic/45.jpg srcset="/posts/hack/xeasemusic/45_hu6325548375b8a613a6d3076fa4d99c71_18813_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/45_hu6325548375b8a613a6d3076fa4d99c71_18813_1024x0_resize_q75_box.jpg 1024w" width=504 height=244 loading=lazy alt=image-45></a><figcaption>image-45</figcaption></figure></p><p>可以看到<code>getArguments()</code>只是返回了<code>this.mArguments</code>, 而<code>this.mArguments</code>是从<code>setArguments(Bundle bundle)</code>赋值的, <strong>那我只要拦截赋值方法将<code>adInfo</code>这个广告过滤掉就可以了</strong></p><p>于是编写<code>xposed</code>代码如下</p><pre><code>findAndHookMethod(
    &quot;androidx.fragment.app.Fragment&quot;, 
    loadPackageParam.classLoader, 
    &quot;setArguments&quot;,
    Bundle.class, 
    new XC_MethodHook() {
        @Override
        protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
            Bundle arg = (Bundle) param.args[0];
            if (arg == null || !arg.containsKey(&quot;adInfo&quot;)) {
                return;
            }
            arg.putSerializable(&quot;adInfo&quot;, null);
        }
    }
);
</code></pre><p>这里拦截了<code>setArguments</code>, 判断传入的参数是否包含键为<code>adInfo</code>的参数, 如果有的话, 把这个<code>bundle</code>设置为<code>null</code></p><p>但这并不完美, 因为只是隐藏了广告, 请求广告的代码任然会执行, 浪费资源, 因此继续深入追踪代码, 再经过一番我也不记得当时怎么找到现在也因为很复杂懒得找的寻找之后, 最终确定到<code>com.马赛克ease.马赛克music.module.ad.a.a</code>类中的<code>a(int, string)</code>是实际执行请求广告的代码, 如下:</p><p><figure style=flex-grow:421;flex-basis:1012px><a href=/posts/hack/xeasemusic/46.jpg data-size=1004x238><img src=/posts/hack/xeasemusic/46.jpg srcset="/posts/hack/xeasemusic/46_hu169fb9caf5cc741615e5f8bd116b3726_26246_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/46_hu169fb9caf5cc741615e5f8bd116b3726_26246_1024x0_resize_q75_box.jpg 1024w" width=1004 height=238 loading=lazy alt=image-46></a><figcaption>image-46</figcaption></figure></p><p>这一部分代码无法反编译出来, 但问题不大, 反正不需要执行这部分代码, 直接编写<code>xposed</code>代码如下</p><pre><code>findAndHookMethod(
    &quot;com.马赛克ease.马赛克music.module.ad.a&quot;, 
    loadPackageParam.classLoader, 
    &quot;a&quot;,
    int.class,
    String.class,
    new XC_MethodReplacement() {
        @Override
        protected Object replaceHookedMethod(MethodHookParam methodHookParam) throws Throwable {
            return null;
        }
    }
);
</code></pre><p>直接拦截并替换掉目标方法, 不做任何事情, 这样一来就不会再请求广告了, 编译后运行发现进入速度变快了也没有烦人的开屏广告了</p><h2 id=6去除更新检查>6.去除更新检查</h2><p>更新弹窗非常烦人, 必须干掉. 首先一般更新检查都是调用的同一个地方的代码, 直接来到APP的"关于"界面, 找到更新检查按钮, 通过<a class=link href=https://developer.android.google.cn/studio/profile/monitor target=_blank rel=noopener>Android Device Monitor</a>可以看到更新按钮的<code>id</code>为<code>updateVersionArea</code></p><p><figure style=flex-grow:226;flex-basis:544px><a href=/posts/hack/xeasemusic/47.jpg data-size=1197x528><img src=/posts/hack/xeasemusic/47.jpg srcset="/posts/hack/xeasemusic/47_hud947ccd3a7c7b7136eb52056bb56732d_61563_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/47_hud947ccd3a7c7b7136eb52056bb56732d_61563_1024x0_resize_q75_box.jpg 1024w" width=1197 height=528 loading=lazy alt=image-47></a><figcaption>image-47</figcaption></figure></p><p>全局搜索这个<code>id</code>, 在<code>setOnClickListener</code>处有调用</p><p><figure style=flex-grow:127;flex-basis:306px><a href=/posts/hack/xeasemusic/48.jpg data-size=646x506><img src=/posts/hack/xeasemusic/48.jpg srcset="/posts/hack/xeasemusic/48_hue442558403451ff61162f07f30f426d4_45011_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/48_hue442558403451ff61162f07f30f426d4_45011_1024x0_resize_q75_box.jpg 1024w" width=646 height=506 loading=lazy alt=image-48></a><figcaption>image-48</figcaption></figure></p><p>这里直接通过调用方法传入了参数, 一路跟踪这个方法, 都是比较简单的调用, 这里的分支查看<code>super.a(z)</code>的代码</p><p><figure style=flex-grow:502;flex-basis:1206px><a href=/posts/hack/xeasemusic/50.jpg data-size=754x150><img src=/posts/hack/xeasemusic/50.jpg srcset="/posts/hack/xeasemusic/50_hu3c01c65140aac6ca3e8e56aaa092b83a_11725_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/50_hu3c01c65140aac6ca3e8e56aaa092b83a_11725_1024x0_resize_q75_box.jpg 1024w" width=754 height=150 loading=lazy alt=image-50></a><figcaption>image-50</figcaption></figure></p><p>最终会来到<code>com.马赛克ease.马赛克music.appupdate.a.a</code>类, 看这个包名推测确实没找错地方, 而最终调用的<code>a(boolean)</code>应该就是检查更新的核心代码</p><p><figure style=flex-grow:143;flex-basis:345px><a href=/posts/hack/xeasemusic/49.jpg data-size=640x445><img src=/posts/hack/xeasemusic/49.jpg srcset="/posts/hack/xeasemusic/49_hu39405a5d90059febad4cd7ce50059634_31986_480x0_resize_q75_box.jpg 480w, /posts/hack/xeasemusic/49_hu39405a5d90059febad4cd7ce50059634_31986_1024x0_resize_q75_box.jpg 1024w" width=640 height=445 loading=lazy alt=image-49></a><figcaption>image-49</figcaption></figure></p><p>不多说直接编写<code>xposed</code>代码进行拦截, 代码如下</p><pre><code>findAndHookMethod(
    &quot;com.马赛克ease.马赛克music.appupdate.a&quot;, 
    loadPackageParam.classLoader, 
    &quot;a&quot;,
    boolean.class,
    new XC_MethodReplacement() {
        @Override
        protected Object replaceHookedMethod(MethodHookParam methodHookParam) throws Throwable {
            return null;
        }
    }
);
</code></pre><p>直接将拦截目标方法替换掉, 不执行任何业务, 编译后再次打开APP会发现已经去除了更新检查, 至此, 所有该整改都已经完成</p><h2 id=附录>附录</h2><hr><ul><li><em>由于这APP将所有字符串加密, 因此很多节点无法直接通过文本搜索, <strong>经发现其解密部分的代码位于<code>a.auu.a</code>的<code>c(string)</code>方法</strong>, 可以通过<code>xposed</code>拦截前后参数来获得解密前和解密后的数据, 代码如下</em></li></ul><pre><code>findAndHookMethod(
    &quot;a.auu.a&quot;, loadPackageParam.classLoader, 
    &quot;c&quot;, 
    String.class,  
    new XC_MethodHook() {
        @Override
        protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
            strBeforeDec = param.args[0];
        }

        @Override
        protected void afterHookedMethod(MethodHookParam param) throws Throwable {
            MyLog.log(strBeforeDec.toString(), param.getResult().toString(), doLog);
        }
    }
);
</code></pre><p>该代码先拦截入参, 把参数记录一下, 在解密方法执行完之后打印入参和出参, 除此之外, 也可以使用<code>xposed</code>去主动调用解密方法, 代码如下</p><pre><code>Class[] argCls = new Class[]{String.class};
Object result = callStaticMethod(findClass(&quot;a.auu.a&quot;, loadPackageParam.classLoader), &quot;c&quot;, argCls, &quot;待解密&quot;);
</code></pre><ul><li><em>拦截存储目录</em></li></ul><p>可以通过以下代码拦截APP能够获取到的储存目录</p><pre><code>findAndHookMethod(
    &quot;com.马赛克ease.马赛克music.utils.马赛克easeMusicUtils&quot;, 
    loadPackageParam.classLoader, 
    &quot;c&quot;, 
    boolean.class, 
    new XC_MethodHook() {
        @Override
        protected void afterHookedMethod(MethodHookParam param) throws Throwable {
        }

        @Override
        protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
        }
    }
);
</code></pre><p><code>马赛克easeMusicUtils</code>工具类包含读取内置存储目录的方法, 可以在这里拦截并修改对应参数使得APP读取指定的目录</p><blockquote><p>当初是因为APP总是读取到我音乐文件夹以外的文件夹, APP自带的过滤器又没有效果, 只能我自己改了</p></blockquote><h2 id=结语>结语</h2><p>不得不说这混淆确实增加了很多麻烦, 尤其是当初找广告代码的时候, 不过随着经验的增加现在找起来比以前快了很多, 另外国产APP真就一个比一个流氓, 越更新越是增加乱七八糟的功能, 因为可以同步歌单才一直没卸载, 但随着版权越抓越紧, 它已经越来越不好用了, 现在移动端已经卸载换了一个纯粹的本地播放器, 希望PC端能够保持初心吧</p></section><footer class=article-footer><section class=article-tags><a href=/tags/hack/>Hack</a>
<a href=/tags/android/>Android</a>
<a href=/tags/xposed/>Xposed</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2021 Acgnu+</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>