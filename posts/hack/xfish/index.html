<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="背景 作为一个家徒四壁的打工人, 在某鱼上购买二手的闲置商品便成了我实现梦想的捷径, 但某鱼经过多次升级改版已经相当流氓, 在我搜索出想要的商品的结果页, 嵌入识别度很低的广告, 导致我经常手滑点错, 然后直接跳转启动某宝, 某宝的启动速度又慢的令人发指, 最终还得按下多次返回才能再次回到某鱼的搜索结果页, 忍无可忍的我只能对它做一些不可描述的事了
目标 破解某鱼(版本: 6.7.40)并去除搜索结果页的广告, 同时去掉每次启动就弹窗的恼人的更新提示
某鱼的搜索结果页  某鱼广告 
 PS:一个屏幕总共就6个展位, 某鱼你这三个广告位良心不会痛吗
 开始破解 首先尝试使用Android反编译大杀器Jadx, 打开Jadx, 直接把某鱼安装包即.apk文件拖进去, 发现软件没有加壳, 可以看到Jadx顺利反编译出了某鱼的源码
 JADX-源码 
直接按 Ctrl + S 将源码全部保存, 然后导入IDEA, 开始分析代码
首先从输入搜索目标后, 点击搜索的按钮开始入手
 搜索面板 
在代码中查找&amp;quot;搜索&amp;quot;关键字, 发现有多处匹配, 结合搜索面板底下的历史搜索布局, 推测该面板的布局文件应该是search_mid.xml
 面板代码 
搜索布局文件引用的地方, 发现其在SearchMidActivity中被使用
 布局使用 
再查看布局文件代码, 搜索按钮的组件ID为search_button, 在SearchMidActivity中查找相关引用
 搜索点击1 
 搜索点击2 
可以看出按钮点击后, 首先会调用searchKeyAction, 再经过层层调用最后到达searchNormal, 之后就会通过 gotoResultActivity 跳转到结果页, 继续跟踪gotoResultActivity方法"><title>某鱼APP破解去广告</title><link rel=canonical href=https://example.com/posts/hack/xfish/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="某鱼APP破解去广告"><meta property="og:description" content="背景 作为一个家徒四壁的打工人, 在某鱼上购买二手的闲置商品便成了我实现梦想的捷径, 但某鱼经过多次升级改版已经相当流氓, 在我搜索出想要的商品的结果页, 嵌入识别度很低的广告, 导致我经常手滑点错, 然后直接跳转启动某宝, 某宝的启动速度又慢的令人发指, 最终还得按下多次返回才能再次回到某鱼的搜索结果页, 忍无可忍的我只能对它做一些不可描述的事了
目标 破解某鱼(版本: 6.7.40)并去除搜索结果页的广告, 同时去掉每次启动就弹窗的恼人的更新提示
某鱼的搜索结果页  某鱼广告 
 PS:一个屏幕总共就6个展位, 某鱼你这三个广告位良心不会痛吗
 开始破解 首先尝试使用Android反编译大杀器Jadx, 打开Jadx, 直接把某鱼安装包即.apk文件拖进去, 发现软件没有加壳, 可以看到Jadx顺利反编译出了某鱼的源码
 JADX-源码 
直接按 Ctrl + S 将源码全部保存, 然后导入IDEA, 开始分析代码
首先从输入搜索目标后, 点击搜索的按钮开始入手
 搜索面板 
在代码中查找&amp;quot;搜索&amp;quot;关键字, 发现有多处匹配, 结合搜索面板底下的历史搜索布局, 推测该面板的布局文件应该是search_mid.xml
 面板代码 
搜索布局文件引用的地方, 发现其在SearchMidActivity中被使用
 布局使用 
再查看布局文件代码, 搜索按钮的组件ID为search_button, 在SearchMidActivity中查找相关引用
 搜索点击1 
 搜索点击2 
可以看出按钮点击后, 首先会调用searchKeyAction, 再经过层层调用最后到达searchNormal, 之后就会通过 gotoResultActivity 跳转到结果页, 继续跟踪gotoResultActivity方法"><meta property="og:url" content="https://example.com/posts/hack/xfish/"><meta property="og:site_name" content="Acgnu+"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="Hack"><meta property="article:tag" content="Android"><meta property="article:tag" content="Xposed"><meta property="article:published_time" content="2021-06-08T00:50:44+08:00"><meta property="article:modified_time" content="2021-06-08T00:50:44+08:00"><meta property="og:image" content="https://example.com/posts/hack/xfish/cover.png"><meta name=twitter:title content="某鱼APP破解去广告"><meta name=twitter:description content="背景 作为一个家徒四壁的打工人, 在某鱼上购买二手的闲置商品便成了我实现梦想的捷径, 但某鱼经过多次升级改版已经相当流氓, 在我搜索出想要的商品的结果页, 嵌入识别度很低的广告, 导致我经常手滑点错, 然后直接跳转启动某宝, 某宝的启动速度又慢的令人发指, 最终还得按下多次返回才能再次回到某鱼的搜索结果页, 忍无可忍的我只能对它做一些不可描述的事了
目标 破解某鱼(版本: 6.7.40)并去除搜索结果页的广告, 同时去掉每次启动就弹窗的恼人的更新提示
某鱼的搜索结果页  某鱼广告 
 PS:一个屏幕总共就6个展位, 某鱼你这三个广告位良心不会痛吗
 开始破解 首先尝试使用Android反编译大杀器Jadx, 打开Jadx, 直接把某鱼安装包即.apk文件拖进去, 发现软件没有加壳, 可以看到Jadx顺利反编译出了某鱼的源码
 JADX-源码 
直接按 Ctrl + S 将源码全部保存, 然后导入IDEA, 开始分析代码
首先从输入搜索目标后, 点击搜索的按钮开始入手
 搜索面板 
在代码中查找&amp;quot;搜索&amp;quot;关键字, 发现有多处匹配, 结合搜索面板底下的历史搜索布局, 推测该面板的布局文件应该是search_mid.xml
 面板代码 
搜索布局文件引用的地方, 发现其在SearchMidActivity中被使用
 布局使用 
再查看布局文件代码, 搜索按钮的组件ID为search_button, 在SearchMidActivity中查找相关引用
 搜索点击1 
 搜索点击2 
可以看出按钮点击后, 首先会调用searchKeyAction, 再经过层层调用最后到达searchNormal, 之后就会通过 gotoResultActivity 跳转到结果页, 继续跟踪gotoResultActivity方法"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://example.com/posts/hack/xfish/cover.png"><link rel="shortcut icon" href=/favicon.ico></head><body class="article-page keep-sidebar"><script>(function(){const colorSchemeKey='StackColorScheme';if(!localStorage.getItem(colorSchemeKey)){localStorage.setItem(colorSchemeKey,"auto");}})();</script><script>(function(){const colorSchemeKey='StackColorScheme';const colorSchemeItem=localStorage.getItem(colorSchemeKey);const supportDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches===true;if(colorSchemeItem=='dark'||colorSchemeItem==='auto'&&supportDarkMode){document.body.dataset.scheme='dark';}else{document.body.dataset.scheme='light';}})();</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu3a9833e4ebdcf9e444b7caf140fa72b8_113624_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>😎</span></figure><h1 class=site-name><a href=https://example.com>Acgnu+</a></h1><h2 class=site-description>時間はいつも足りない</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/hack/xfish/><img src=/posts/hack/xfish/cover_hu6805bb858ef8d6e39da1ca045c198567_262554_800x0_resize_box_2.png srcset="/posts/hack/xfish/cover_hu6805bb858ef8d6e39da1ca045c198567_262554_800x0_resize_box_2.png 800w, /posts/hack/xfish/cover_hu6805bb858ef8d6e39da1ca045c198567_262554_1600x0_resize_box_2.png 1600w" width=800 height=476 loading=lazy alt="Featured image of post 某鱼APP破解去广告"></a></div><div class=article-details><header class=article-category><a href=/categories/hack/>Hack</a></header><h2 class=article-title><a href=/posts/hack/xfish/>某鱼APP破解去广告</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Jun 08, 2021</time></footer></div></header><section class=article-content><h2 id=背景>背景</h2><p>作为一个家徒四壁的打工人, 在某鱼上购买二手的闲置商品便成了我实现梦想的捷径, 但某鱼经过多次升级改版已经相当流氓, 在我搜索出想要的商品的结果页, 嵌入识别度很低的广告, 导致我经常手滑点错, 然后直接跳转启动某宝, 某宝的启动速度又慢的令人发指, 最终还得按下多次返回才能再次回到某鱼的搜索结果页, 忍无可忍的我只能对它做一些不可描述的事了</p><h2 id=目标>目标</h2><p>破解某鱼(版本: 6.7.40)并去除搜索结果页的广告, 同时去掉每次启动就弹窗的恼人的更新提示</p><h2 id=某鱼的搜索结果页>某鱼的搜索结果页</h2><p><figure style=flex-grow:56;flex-basis:134px><a href=/posts/hack/xfish/adpage.jpg data-size=540x961><img src=/posts/hack/xfish/adpage.jpg srcset="/posts/hack/xfish/adpage_hu1ba7e09bc24973772dcedd1129f840e8_86307_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/adpage_hu1ba7e09bc24973772dcedd1129f840e8_86307_1024x0_resize_q75_box.jpg 1024w" width=540 height=961 loading=lazy alt=某鱼广告></a><figcaption>某鱼广告</figcaption></figure></p><blockquote><p>PS:一个屏幕总共就6个展位, 某鱼你这三个广告位良心不会痛吗</p></blockquote><h2 id=开始破解>开始破解</h2><p>首先尝试使用Android反编译大杀器<a class=link href=https://github.com/skylot/jadx target=_blank rel=noopener>Jadx</a>, 打开<code>Jadx</code>, 直接把某鱼安装包即<code>.apk</code>文件拖进去, 发现软件没有加壳, 可以看到<code>Jadx</code>顺利反编译出了某鱼的源码</p><p><figure style=flex-grow:139;flex-basis:334px><a href=/posts/hack/xfish/jadx_source.jpg data-size=1173x842><img src=/posts/hack/xfish/jadx_source.jpg srcset="/posts/hack/xfish/jadx_source_hud0af3715194ff4882a261e5347d833be_127929_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/jadx_source_hud0af3715194ff4882a261e5347d833be_127929_1024x0_resize_q75_box.jpg 1024w" width=1173 height=842 loading=lazy alt=JADX-源码></a><figcaption>JADX-源码</figcaption></figure></p><p>直接按 <code>Ctrl + S</code> 将源码全部保存, 然后导入<code>IDEA</code>, 开始分析代码</p><p><strong>首先从输入搜索目标后, 点击搜索的按钮开始入手</strong></p><p><figure style=flex-grow:249;flex-basis:599px><a href=/posts/hack/xfish/search.jpg data-size=537x215><img src=/posts/hack/xfish/search.jpg srcset="/posts/hack/xfish/search_hubb017e4f37f205bfbcd52d21910b75ab_11320_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/search_hubb017e4f37f205bfbcd52d21910b75ab_11320_1024x0_resize_q75_box.jpg 1024w" width=537 height=215 loading=lazy alt=搜索面板></a><figcaption>搜索面板</figcaption></figure></p><p>在代码中查找"搜索"关键字, 发现有多处匹配, 结合搜索面板底下的历史搜索布局, 推测该面板的布局文件应该是<code>search_mid.xml</code></p><p><figure style=flex-grow:212;flex-basis:510px><a href=/posts/hack/xfish/searchlayout.jpg data-size=1078x507><img src=/posts/hack/xfish/searchlayout.jpg srcset="/posts/hack/xfish/searchlayout_hu165f087e67dd8c3f20528ecb83d1223f_83048_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/searchlayout_hu165f087e67dd8c3f20528ecb83d1223f_83048_1024x0_resize_q75_box.jpg 1024w" width=1078 height=507 loading=lazy alt=面板代码></a><figcaption>面板代码</figcaption></figure></p><p>搜索布局文件引用的地方, 发现其在<code>SearchMidActivity</code>中被使用</p><p><figure style=flex-grow:342;flex-basis:821px><a href=/posts/hack/xfish/uselayout.jpg data-size=606x177><img src=/posts/hack/xfish/uselayout.jpg srcset="/posts/hack/xfish/uselayout_huf0a2434a3d7d0179055128c7c7a27089_13700_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/uselayout_huf0a2434a3d7d0179055128c7c7a27089_13700_1024x0_resize_q75_box.jpg 1024w" width=606 height=177 loading=lazy alt=布局使用></a><figcaption>布局使用</figcaption></figure></p><p>再查看布局文件代码, 搜索按钮的组件ID为<code>search_button</code>, 在<code>SearchMidActivity</code>中查找相关引用</p><p><figure style=flex-grow:316;flex-basis:758px><a href=/posts/hack/xfish/searchbtn1.jpg data-size=351x111><img src=/posts/hack/xfish/searchbtn1.jpg srcset="/posts/hack/xfish/searchbtn1_hud7caf3cc5e731a5a19c2db74ba6f7cd8_6010_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/searchbtn1_hud7caf3cc5e731a5a19c2db74ba6f7cd8_6010_1024x0_resize_q75_box.jpg 1024w" width=351 height=111 loading=lazy alt=搜索点击1></a><figcaption>搜索点击1</figcaption></figure></p><p><figure style=flex-grow:277;flex-basis:667px><a href=/posts/hack/xfish/searchbtn2.jpg data-size=795x286><img src=/posts/hack/xfish/searchbtn2.jpg srcset="/posts/hack/xfish/searchbtn2_hu43e90636119c85769bcd2cb8b226da7a_24664_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/searchbtn2_hu43e90636119c85769bcd2cb8b226da7a_24664_1024x0_resize_q75_box.jpg 1024w" width=795 height=286 loading=lazy alt=搜索点击2></a><figcaption>搜索点击2</figcaption></figure></p><p>可以看出按钮点击后, 首先会调用<code>searchKeyAction</code>, 再经过层层调用最后到达<code>searchNormal</code>, 之后就会通过 <code>gotoResultActivity</code> 跳转到结果页, 继续跟踪<code>gotoResultActivity</code>方法</p><p><figure style=flex-grow:700;flex-basis:1680px><a href=/posts/hack/xfish/searchbtn3.jpg data-size=525x75><img src=/posts/hack/xfish/searchbtn3.jpg srcset="/posts/hack/xfish/searchbtn3_hu5fb2147c87591b6c85c08e2046a0c2df_6451_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/searchbtn3_hu5fb2147c87591b6c85c08e2046a0c2df_6451_1024x0_resize_q75_box.jpg 1024w" width=525 height=75 loading=lazy alt=搜索点击3></a><figcaption>搜索点击3</figcaption></figure></p><p>此处出现<code>searchresult</code>字符, 搜索这个字符</p><p><figure style=flex-grow:469;flex-basis:1127px><a href=/posts/hack/xfish/searchbtn4.jpg data-size=780x166><img src=/posts/hack/xfish/searchbtn4.jpg srcset="/posts/hack/xfish/searchbtn4_hu3064fae03e259149ff91124b7637e5f8_29435_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/searchbtn4_hu3064fae03e259149ff91124b7637e5f8_29435_1024x0_resize_q75_box.jpg 1024w" width=780 height=166 loading=lazy alt=搜索点击4></a><figcaption>搜索点击4</figcaption></figure></p><p>可以看出这个字符串对应的页面应该是 <code>SearchResultActivity</code>, 打开这个类之后一眼看不出什么重要的东西, 然后线索就这么中断了</p><p>线索中断之后, 可以用<code>Xposed</code>对某些可疑方法<code>Hook</code>, 然后通过打印调用堆栈的方法, 继续分析, 比如此我找到的<code>SearchResultInterrupter</code>中的<code>checkInterrupt</code>方法</p><blockquote><p><code>Xposed</code>是一款<code>Android</code>底层的框架, 能够从虚拟机层拦截系统所有执行代码, 而<code>Xposed</code>模块是使用<code>Xposed</code>提供的<code>SDK</code>所开发的<code>Android</code>应用, 能够借助<code>Xposed</code>实现对所有关心代码的拦截, 详情请戳<a class=link href=https://repo.xposed.info/ target=_blank rel=noopener>Xposed官网</a></p></blockquote><pre><code>Throwable ex = new Throwable();
StackTraceElement[] stackElements = ex.getStackTrace();
if (stackElements != null) {
    MyLog.log(&quot;调用堆栈:--------------------&quot;, true);
    for (int i = 0; i &lt; stackElements.length; i++) {
    MyLog.log(stackElements[i].getClassName() + &quot; -&gt; &quot; +
            stackElements[i].getMethodName() + &quot;()&quot;
        , true);
    }
}
</code></pre><p>不过这样比较麻烦而且也不好找. 于是换个思路, 安装<code>Xposed</code>模块<a class=link href=https://github.com/Palatis/XAppDebug target=_blank rel=noopener>XAppDebug</a>, 为某鱼强制开启<code>Debug</code>模式, 此时查看控制台会显示所有某鱼打印的日志信息, 现在控制台显示了包括网络请求在内的日志信息</p><p><figure style=flex-grow:379;flex-basis:911px><a href=/posts/hack/xfish/motp.jpg data-size=1136x299><img src=/posts/hack/xfish/motp.jpg srcset="/posts/hack/xfish/motp_hu728bdb3602c9c0a190a3b046fde1f8dd_69023_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/motp_hu728bdb3602c9c0a190a3b046fde1f8dd_69023_1024x0_resize_q75_box.jpg 1024w" width=1136 height=299 loading=lazy alt=MTOP></a><figcaption>MTOP</figcaption></figure></p><p>最终找到可疑类<code>MtopResponse</code>, 分析代码可以推测这个类应该是一个封装了网络响应的类, 其成员变量<code>bytedata</code>是主要数据源, <code>bytedata</code>将会被转换成<code>dataJsonObject</code>的<code>JSON</code>对象储存, 然后被使用, 因此找到<code>bytedata</code>赋值的方法<code>setBytedata</code></p><p><figure style=flex-grow:287;flex-basis:691px><a href=/posts/hack/xfish/rep.jpg data-size=478x166><img src=/posts/hack/xfish/rep.jpg srcset="/posts/hack/xfish/rep_huaa9da268be2d331c855d2c964a90ed3f_10820_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/rep_huaa9da268be2d331c855d2c964a90ed3f_10820_1024x0_resize_q75_box.jpg 1024w" width=478 height=166 loading=lazy alt=响应模型></a><figcaption>响应模型</figcaption></figure></p><blockquote><p>破解时间于2020年8月, 文章编辑时间为2021年6月, 我也不记得当初是不是这样找到<code>MtopResponse</code>类的, 没有记录下来是我的失误也是我的损失, 现在能找到这个类是因为当时开发<code>Xposed</code>模块中的代码有这一段. 如果某天我突然想起来了或者有兴致花时间重新找的话, 会回来补充的</p></blockquote><p>使用<code>Xposed</code>拦截此函数, 并打印入参</p><pre><code>findAndHookMethod(&quot;mtopsdk.mtop.domain.MtopResponse&quot;, loadPackageParam.classLoader,
        &quot;setBytedata&quot;,
        byte[].class,
    new XC_MethodHook() {
        @Override
        protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
            String content = new String((byte[]) param.args[0]);
            MyLog.log(content);
        }
    });
</code></pre><p>得到入参截取如下</p><pre><code>&quot;data&quot;: {
    &quot;item&quot;: {
        ...
        &quot;main&quot;: {
            &quot;clickParam&quot;: {
                &quot;arg1&quot;: &quot;Item&quot;,
                &quot;args&quot;: {
                    ...
                    &quot;tagname&quot;: &quot;全新\/极好\/298人想要&quot;,
                    &quot;wantNum&quot;: &quot;298&quot;,
                    &quot;id&quot;: &quot;619312410203&quot;,
                    &quot;tag&quot;: &quot;new\/credit-6\/wantnum-298&quot;,
                    &quot;scm&quot;: &quot;1007.32845.224895.0&quot;,
                    &quot;publishTime&quot;: &quot;1590461455000&quot;,
                    &quot;i2i&quot;: &quot;相似&quot;,
                    &quot;search_tab_from&quot;: null,
                    &quot;item_id&quot;: &quot;619312410203&quot;,
                    &quot;biz_type&quot;: &quot;item&quot;,             //破解重点
                    &quot;q&quot;: &quot;10700k&quot;,
                    ...
                },
                &quot;page&quot;: &quot;Page_xySearchResult&quot;
            },
            ...
        }
    }
    ...
}
...
</code></pre><p>此处截取了一条记录展示, 实际拦截到的参数中是一个数组, 包含本次结果页的所有商品, 其中就包括了搜索的商品, 广告商品, 推荐商品等, 通过对比发现, <strong>搜索的商品数据在节点<code>args</code> > <code>biz_type</code> 的取值为 <code>item</code>, 而广告等商品取值为<code>ad</code>, <code>Bagtag</code>, <code>聚合卡片</code></strong>, 那么接下来要做的事就很明确了, <strong>解析这个字符串, 如果发现是广告商品则从数据中删除这条数据</strong>, 修改对<code>setBytedate</code>的<code>Hook</code>代码如下</p><pre><code>...
protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
    if (null == param.args[0] || ((byte[]) param.args[0]).length == 0) {
        return;
    }
    String content = new String((byte[]) param.args[0]);
    JSONObject jsonContent = new JSONObject(content);
    JSONObject jsonData = jsonContent.optJSONObject(&quot;data&quot;);
    if (null == jsonData || !jsonData.has(&quot;resultList&quot;)) {
        return;
    }
    JSONArray resultList = jsonData.getJSONArray(&quot;resultList&quot;);
    List&lt;String&gt; filterList = Arrays.asList(&quot;ad&quot;, &quot;Bagtag&quot;, &quot;聚合卡片&quot;);
    for (int i = 0; i &lt; resultList.length(); i++) {
        JSONObject listItem = resultList.getJSONObject(i);
        String bizType = listItem.getJSONObject(&quot;data&quot;).getJSONObject(&quot;item&quot;)
            .getJSONObject(&quot;main&quot;).getJSONObject(&quot;clickParam&quot;).getJSONObject(&quot;args&quot;)
            .getString(&quot;biz_type&quot;);
        if (filterList.contains(bizType)) {
            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) {
                resultList.remove(i);
                i--;
            }
        }
    }
    param.args[0] = jsonContent.toString().getBytes();
}
...
</code></pre><p>上述代码首先将<code>byte</code>数组转换为<code>json</code>对象, 然后遍历所有商品, 将找到的广告商品移除, 再将处理过后的字符串重新转换为<code>byte</code>数组, 最后赋值给原始参数, 这样当某鱼实际代码<code>setBytedata</code>得到的参数将会是我修改后的参数. 编译验证后可以看到广告已经不会再显示了</p><p><figure style=flex-grow:56;flex-basis:136px><a href=/posts/hack/xfish/noadresult.jpg data-size=529x933><img src=/posts/hack/xfish/noadresult.jpg srcset="/posts/hack/xfish/noadresult_hufb7fc091ad8dd52f3bb83e2bc584be96_75816_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/noadresult_hufb7fc091ad8dd52f3bb83e2bc584be96_75816_1024x0_resize_q75_box.jpg 1024w" width=529 height=933 loading=lazy alt=哇塞></a><figcaption>哇塞</figcaption></figure></p><h2 id=禁用恼人的升级弹窗>禁用恼人的升级弹窗</h2><p><strong>由于本人不爱更新, 且破解后如果更新版本, 可能导致破解失效, 所以必须禁用更新</strong></p><p>首先根据弹窗文字搜索代码</p><p><figure style=flex-grow:128;flex-basis:309px><a href=/posts/hack/xfish/updateprop.jpg data-size=487x378><img src=/posts/hack/xfish/updateprop.jpg srcset="/posts/hack/xfish/updateprop_huc83cba95d5fbda156357bc25e87590dc_41270_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/updateprop_huc83cba95d5fbda156357bc25e87590dc_41270_1024x0_resize_q75_box.jpg 1024w" width=487 height=378 loading=lazy alt=更新弹窗></a><figcaption>更新弹窗</figcaption></figure></p><p>发现仅有一处, 位于<code>BaseUpgradeHandler</code>类的<code>onUpgradeNeed()</code>方法</p><p><figure style=flex-grow:136;flex-basis:327px><a href=/posts/hack/xfish/updatecode.jpg data-size=609x446><img src=/posts/hack/xfish/updatecode.jpg srcset="/posts/hack/xfish/updatecode_hue08c2e2c8268d22c9b70d5b029bd39b2_29411_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/updatecode_hue08c2e2c8268d22c9b70d5b029bd39b2_29411_1024x0_resize_q75_box.jpg 1024w" width=609 height=446 loading=lazy alt=更新代码></a><figcaption>更新代码</figcaption></figure></p><p>跟踪方法调用, 在<code>com.马赛克.马赛克fish.upgrade.traceable.Upgrade</code>类的<code>c</code>方法中被调用, 而<code>c</code>则被<code>b</code>调用</p><p><figure style=flex-grow:189;flex-basis:454px><a href=/posts/hack/xfish/updatecall1.jpg data-size=705x372><img src=/posts/hack/xfish/updatecall1.jpg srcset="/posts/hack/xfish/updatecall1_hu44c789f25140b4297b45caa6517061ba_31907_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/updatecall1_hu44c789f25140b4297b45caa6517061ba_31907_1024x0_resize_q75_box.jpg 1024w" width=705 height=372 loading=lazy alt=更新1></a><figcaption>更新1</figcaption></figure></p><p><figure style=flex-grow:290;flex-basis:696px><a href=/posts/hack/xfish/updatecall2.jpg data-size=708x244><img src=/posts/hack/xfish/updatecall2.jpg srcset="/posts/hack/xfish/updatecall2_hu8b4e53f6efc16eee43e3c0879d76ef38_23057_480x0_resize_q75_box.jpg 480w, /posts/hack/xfish/updatecall2_hu8b4e53f6efc16eee43e3c0879d76ef38_23057_1024x0_resize_q75_box.jpg 1024w" width=708 height=244 loading=lazy alt=更新2></a><figcaption>更新2</figcaption></figure></p><p>重点代码摘要如下:</p><pre><code>private void c(final UpgradeHandler handler) {
    if (handler != null) {
        ...           
        handler.onUpgradeNeed(info, tracer);
        ...
    }
}
</code></pre><p><code>c</code>中的代码的突破点在于, <strong>如果传入的<code>handler</code>不为<code>null</code>, 才会执行更新检测并弹窗的方法</strong>, 那么我只需要让传入的<code>handler</code>为<code>null</code>就可以了. 在<code>Xposed</code>模块中对<code>Upgrade</code>类的<code>b</code>方法<code>Hook</code>, 将入参设置为<code>null</code></p><pre><code>findAndHookMethod(&quot;com.马赛克.马赛克fish.upgrade.traceable.Upgrade&quot;,loadPackageParam.classLoader,
    &quot;b&quot;,
    &quot;com.马赛克.马赛克fish.upgrade.traceable.UpgradeHandler&quot;,
    new XC_MethodHook() {
        @Override
        protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
            //这里将入参设置为null
            param.args[0] = null;
        }
    }
);
</code></pre><p>重新进行测试, <strong>一切正常且启动之后不再有更新弹窗了</strong></p></section><footer class=article-footer><section class=article-tags><a href=/tags/hack/>Hack</a>
<a href=/tags/android/>Android</a>
<a href=/tags/xposed/>Xposed</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2021 Acgnu+</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>