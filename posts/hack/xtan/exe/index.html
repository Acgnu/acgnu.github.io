<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="引言 本文接另一篇文章 某乐谱网站Flash播放器破解记录
由于乐谱网站改版正式使用exe播放器之后, 删除了所有的.ypa2资源, 导致我没有及时下载的乐谱都无法继续使用Flash播放器播放了, 忍不了, 只能破解exe播放器了
目标 破解该站的exe播放器, 使其能够免费播放VIP乐谱, 且可以完全脱机使用
开始破解 首先安装网站的乐谱播放器, 打开安装目录发现文件结构如下
 image-3 
其中xxxchrome.exe相当于一个浏览器, 可以访问乐谱网站, 点击&amp;quot;客户端播放&amp;quot;按钮即可打开播放器, 如下图
 image-2 
而xxplayer.exe才是播放器, 播放器启动后, 可以从任务管理器看到新增的进程
 image-1 
剩下的安装文件和库文件还有配置文件, 就不介绍了.
首先播放一个免费的乐谱, 在任务管理器中查看一下xxplayer.exe的启动参数
 image-4 
完整的启动参数如下
&amp;quot;C:\Program Files\马赛克music\out1\马赛克player.exe&amp;quot; &amp;quot;file=http://www.马赛克.com/open_yp.php?ypid=73981&amp;amp;uid=999999999&amp;amp;token=fbf0ab24ee47bfa1cb460e41c1f61fdb&amp;amp;ypid=73981&amp;quot; 可以看到启动参数主要为
 file 官网的乐谱页地址 ypid 乐谱ID uid 用户ID token 凭证  如果从xxxchrome.exe打开一个VIP乐谱, 则会显示
 image-5 
那么如果我不用他的xxxchrome.exe, 直接从命令行启动xxplayer.exe, 传入一个VIP乐谱ID, 会发生什么呢?
将刚才的启动参数中的ypid参数修改为一个VIP乐谱ID, 通过命令行
xxplayer.exe &amp;quot;file=http://www.马赛克.com/open_yp.php?ypid=33418&amp;amp;uid=999999999&amp;amp;token=4c6930a47090c3f04c7e9db3bf214078&amp;quot; 启动xxplayer.exe之后如下
 image-6"><title>某乐谱网站EXE播放器破解记录</title><link rel=canonical href=https://example.com/posts/hack/xtan/exe/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="某乐谱网站EXE播放器破解记录"><meta property="og:description" content="引言 本文接另一篇文章 某乐谱网站Flash播放器破解记录
由于乐谱网站改版正式使用exe播放器之后, 删除了所有的.ypa2资源, 导致我没有及时下载的乐谱都无法继续使用Flash播放器播放了, 忍不了, 只能破解exe播放器了
目标 破解该站的exe播放器, 使其能够免费播放VIP乐谱, 且可以完全脱机使用
开始破解 首先安装网站的乐谱播放器, 打开安装目录发现文件结构如下
 image-3 
其中xxxchrome.exe相当于一个浏览器, 可以访问乐谱网站, 点击&amp;quot;客户端播放&amp;quot;按钮即可打开播放器, 如下图
 image-2 
而xxplayer.exe才是播放器, 播放器启动后, 可以从任务管理器看到新增的进程
 image-1 
剩下的安装文件和库文件还有配置文件, 就不介绍了.
首先播放一个免费的乐谱, 在任务管理器中查看一下xxplayer.exe的启动参数
 image-4 
完整的启动参数如下
&amp;quot;C:\Program Files\马赛克music\out1\马赛克player.exe&amp;quot; &amp;quot;file=http://www.马赛克.com/open_yp.php?ypid=73981&amp;amp;uid=999999999&amp;amp;token=fbf0ab24ee47bfa1cb460e41c1f61fdb&amp;amp;ypid=73981&amp;quot; 可以看到启动参数主要为
 file 官网的乐谱页地址 ypid 乐谱ID uid 用户ID token 凭证  如果从xxxchrome.exe打开一个VIP乐谱, 则会显示
 image-5 
那么如果我不用他的xxxchrome.exe, 直接从命令行启动xxplayer.exe, 传入一个VIP乐谱ID, 会发生什么呢?
将刚才的启动参数中的ypid参数修改为一个VIP乐谱ID, 通过命令行
xxplayer.exe &amp;quot;file=http://www.马赛克.com/open_yp.php?ypid=33418&amp;amp;uid=999999999&amp;amp;token=4c6930a47090c3f04c7e9db3bf214078&amp;quot; 启动xxplayer.exe之后如下
 image-6"><meta property="og:url" content="https://example.com/posts/hack/xtan/exe/"><meta property="og:site_name" content="Acgnu+"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="Hack"><meta property="article:tag" content="Assembly"><meta property="article:tag" content=".NET"><meta property="article:published_time" content="2021-05-26T00:50:44+08:00"><meta property="article:modified_time" content="2021-05-26T00:50:44+08:00"><meta property="og:image" content="https://example.com/posts/hack/xtan/exe/cover.png"><meta name=twitter:title content="某乐谱网站EXE播放器破解记录"><meta name=twitter:description content="引言 本文接另一篇文章 某乐谱网站Flash播放器破解记录
由于乐谱网站改版正式使用exe播放器之后, 删除了所有的.ypa2资源, 导致我没有及时下载的乐谱都无法继续使用Flash播放器播放了, 忍不了, 只能破解exe播放器了
目标 破解该站的exe播放器, 使其能够免费播放VIP乐谱, 且可以完全脱机使用
开始破解 首先安装网站的乐谱播放器, 打开安装目录发现文件结构如下
 image-3 
其中xxxchrome.exe相当于一个浏览器, 可以访问乐谱网站, 点击&amp;quot;客户端播放&amp;quot;按钮即可打开播放器, 如下图
 image-2 
而xxplayer.exe才是播放器, 播放器启动后, 可以从任务管理器看到新增的进程
 image-1 
剩下的安装文件和库文件还有配置文件, 就不介绍了.
首先播放一个免费的乐谱, 在任务管理器中查看一下xxplayer.exe的启动参数
 image-4 
完整的启动参数如下
&amp;quot;C:\Program Files\马赛克music\out1\马赛克player.exe&amp;quot; &amp;quot;file=http://www.马赛克.com/open_yp.php?ypid=73981&amp;amp;uid=999999999&amp;amp;token=fbf0ab24ee47bfa1cb460e41c1f61fdb&amp;amp;ypid=73981&amp;quot; 可以看到启动参数主要为
 file 官网的乐谱页地址 ypid 乐谱ID uid 用户ID token 凭证  如果从xxxchrome.exe打开一个VIP乐谱, 则会显示
 image-5 
那么如果我不用他的xxxchrome.exe, 直接从命令行启动xxplayer.exe, 传入一个VIP乐谱ID, 会发生什么呢?
将刚才的启动参数中的ypid参数修改为一个VIP乐谱ID, 通过命令行
xxplayer.exe &amp;quot;file=http://www.马赛克.com/open_yp.php?ypid=33418&amp;amp;uid=999999999&amp;amp;token=4c6930a47090c3f04c7e9db3bf214078&amp;quot; 启动xxplayer.exe之后如下
 image-6"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://example.com/posts/hack/xtan/exe/cover.png"><link rel="shortcut icon" href=/favicon.ico></head><body class="article-page keep-sidebar"><script>(function(){const colorSchemeKey='StackColorScheme';if(!localStorage.getItem(colorSchemeKey)){localStorage.setItem(colorSchemeKey,"auto");}})();</script><script>(function(){const colorSchemeKey='StackColorScheme';const colorSchemeItem=localStorage.getItem(colorSchemeKey);const supportDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches===true;if(colorSchemeItem=='dark'||colorSchemeItem==='auto'&&supportDarkMode){document.body.dataset.scheme='dark';}else{document.body.dataset.scheme='light';}})();</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu3a9833e4ebdcf9e444b7caf140fa72b8_113624_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>🍥</span></figure><h1 class=site-name><a href=https://example.com>Acgnu+</a></h1><h2 class=site-description>時間はいつも足りない</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/hack/xtan/exe/><img src=/posts/hack/xtan/exe/cover_hue5cd7e001fbd211aac3b523e6dc2840f_3758639_800x0_resize_box_2.png srcset="/posts/hack/xtan/exe/cover_hue5cd7e001fbd211aac3b523e6dc2840f_3758639_800x0_resize_box_2.png 800w, /posts/hack/xtan/exe/cover_hue5cd7e001fbd211aac3b523e6dc2840f_3758639_1600x0_resize_box_2.png 1600w" width=800 height=476 loading=lazy alt="Featured image of post 某乐谱网站EXE播放器破解记录"></a></div><div class=article-details><header class=article-category><a href=/categories/hack/>Hack</a></header><h2 class=article-title><a href=/posts/hack/xtan/exe/>某乐谱网站EXE播放器破解记录</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>May 26, 2021</time></footer></div></header><section class=article-content><h2 id=引言>引言</h2><p>本文接另一篇文章 <a class=link href=../xtan_flash_hack/index.md>某乐谱网站Flash播放器破解记录</a></p><p>由于乐谱网站改版正式使用exe播放器之后, 删除了所有的<code>.ypa2</code>资源, 导致我没有及时下载的乐谱都无法继续使用Flash播放器播放了, 忍不了, 只能破解exe播放器了</p><h2 id=目标>目标</h2><p>破解该站的exe播放器, 使其能够免费播放VIP乐谱, 且可以完全脱机使用</p><h2 id=开始破解>开始破解</h2><p>首先安装网站的乐谱播放器, 打开安装目录发现文件结构如下</p><p><figure style=flex-grow:78;flex-basis:188px><a href=/posts/hack/xtan/exe/3.jpg data-size=246x313><img src=/posts/hack/xtan/exe/3.jpg srcset="/posts/hack/xtan/exe/3_hue232319cf432e7036953df257266796c_12330_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/3_hue232319cf432e7036953df257266796c_12330_1024x0_resize_q75_box.jpg 1024w" width=246 height=313 loading=lazy alt=image-3></a><figcaption>image-3</figcaption></figure></p><p>其中<code>xxxchrome.exe</code>相当于一个浏览器, 可以访问乐谱网站, 点击"客户端播放"按钮即可打开播放器, 如下图</p><p><figure style=flex-grow:151;flex-basis:363px><a href=/posts/hack/xtan/exe/2.jpg data-size=1116x736><img src=/posts/hack/xtan/exe/2.jpg srcset="/posts/hack/xtan/exe/2_hu497f65295a89ad86247035b74338bec2_76064_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/2_hu497f65295a89ad86247035b74338bec2_76064_1024x0_resize_q75_box.jpg 1024w" width=1116 height=736 loading=lazy alt=image-2></a><figcaption>image-2</figcaption></figure></p><p>而<code>xxplayer.exe</code>才是播放器, 播放器启动后, 可以从任务管理器看到新增的进程</p><p><figure style=flex-grow:128;flex-basis:307px><a href=/posts/hack/xtan/exe/1.jpg data-size=926x722><img src=/posts/hack/xtan/exe/1.jpg srcset="/posts/hack/xtan/exe/1_hud35c019f213a619ddd7799f1e0fa3f93_112502_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/1_hud35c019f213a619ddd7799f1e0fa3f93_112502_1024x0_resize_q75_box.jpg 1024w" width=926 height=722 loading=lazy alt=image-1></a><figcaption>image-1</figcaption></figure></p><p>剩下的安装文件和库文件还有配置文件, 就不介绍了.</p><p>首先播放一个免费的乐谱, 在任务管理器中查看一下<code>xxplayer.exe</code>的启动参数</p><p><figure style=flex-grow:610;flex-basis:1464px><a href=/posts/hack/xtan/exe/4.jpg data-size=946x155><img src=/posts/hack/xtan/exe/4.jpg srcset="/posts/hack/xtan/exe/4_hub8c1251db8423eeb57a6a376306d634c_30464_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/4_hub8c1251db8423eeb57a6a376306d634c_30464_1024x0_resize_q75_box.jpg 1024w" width=946 height=155 loading=lazy alt=image-4></a><figcaption>image-4</figcaption></figure></p><p>完整的启动参数如下</p><pre><code>&quot;C:\Program Files\马赛克music\out1\马赛克player.exe&quot; &quot;file=http://www.马赛克.com/open_yp.php?ypid=73981&amp;uid=999999999&amp;token=fbf0ab24ee47bfa1cb460e41c1f61fdb&amp;ypid=73981&quot;
</code></pre><p>可以看到启动参数主要为</p><ul><li><code>file</code> 官网的乐谱页地址</li><li><code>ypid</code> 乐谱ID</li><li><code>uid</code> 用户ID</li><li><code>token</code> 凭证</li></ul><p>如果从<code>xxxchrome.exe</code>打开一个VIP乐谱, 则会显示</p><p><figure style=flex-grow:103;flex-basis:249px><a href=/posts/hack/xtan/exe/5.jpg data-size=441x425><img src=/posts/hack/xtan/exe/5.jpg srcset="/posts/hack/xtan/exe/5_hua261adef9b482683046becfc9484b40d_36483_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/5_hua261adef9b482683046becfc9484b40d_36483_1024x0_resize_q75_box.jpg 1024w" width=441 height=425 loading=lazy alt=image-5></a><figcaption>image-5</figcaption></figure></p><p>那么如果我不用他的<code>xxxchrome.exe</code>, 直接从命令行启动<code>xxplayer.exe</code>, 传入一个VIP乐谱ID, 会发生什么呢?</p><p>将刚才的启动参数中的<code>ypid</code>参数修改为一个VIP乐谱ID, 通过命令行</p><pre><code>xxplayer.exe &quot;file=http://www.马赛克.com/open_yp.php?ypid=33418&amp;uid=999999999&amp;token=4c6930a47090c3f04c7e9db3bf214078&quot;
</code></pre><p>启动<code>xxplayer.exe</code>之后如下</p><p><figure style=flex-grow:128;flex-basis:307px><a href=/posts/hack/xtan/exe/6.jpg data-size=926x722><img src=/posts/hack/xtan/exe/6.jpg srcset="/posts/hack/xtan/exe/6_hu611ebb7a50cb9110ffdfa4a2b0b1f4b7_52562_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/6_hu611ebb7a50cb9110ffdfa4a2b0b1f4b7_52562_1024x0_resize_q75_box.jpg 1024w" width=926 height=722 loading=lazy alt=image-6></a><figcaption>image-6</figcaption></figure></p><p>非常的正常, 但是至少验证了 <strong><code>xxplayer.exe</code>是可以脱离<code>xxxchrome.exe</code>独立运行的</strong>, 那么既然要鉴权, 不请求服务器肯定是不行的吧? 于是打开<code>Charles</code>开始抓包, 首先用命令行打开一个免费的乐谱, 捕获到网络请求如下</p><p><figure style=flex-grow:217;flex-basis:520px><a href=/posts/hack/xtan/exe/7.jpg data-size=1109x511><img src=/posts/hack/xtan/exe/7.jpg srcset="/posts/hack/xtan/exe/7_hu0c0894aaf992bb2895aba54aaa8c3e13_42004_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/7_hu0c0894aaf992bb2895aba54aaa8c3e13_42004_1024x0_resize_q75_box.jpg 1024w" width=1109 height=511 loading=lazy alt=image-7></a><figcaption>image-7</figcaption></figure></p><p>可以看出主要请求接口为<code>/codeindex.php</code>, 通过参数<code>m</code>做不同功能的权限认证</p><p><strong>当<code>m=index</code>, 验证成功返回权限信息</strong></p><pre><code>{
	&quot;responseCode&quot;: &quot;1000&quot;,
	&quot;message&quot;: &quot;\u6b63\u5e38&quot;,
	&quot;power&quot;: {
		&quot;openPower&quot;: &quot;1&quot;,
		&quot;printPower&quot;: &quot;0&quot;,
		&quot;printCount&quot;: &quot;30&quot;,
		&quot;vstPower&quot;: &quot;0&quot;,
		&quot;pdfPower&quot;: &quot;0&quot;
	}
}
</code></pre><p><strong>当<code>m=getYpdsUrl</code>, 验证成功返回<code>.ypdx</code>格式的播放文件地址</strong></p><pre><code>{
	&quot;data&quot;: {
		&quot;code&quot;: &quot;1000&quot;,
		&quot;message&quot;: &quot;\u83b7\u53d6\u6210\u529f&quot;,
		&quot;result&quot;: {
			&quot;ypdsUrl&quot;: &quot;http:\/\/马赛克.马赛克.com\/yuepuku\/148\/74205\/74205_cfcbahia.ypds&quot;,
			&quot;ypdxUrl&quot;: &quot;http:\/\/马赛克.马赛克.com\/yuepuku\/148\/74205\/74205_cfcbahia.ypdx&quot;
		}
	}
}
</code></pre><p><strong>最后再请求资源地址<code>http:\/\/马赛克.马赛克.com\/yuepuku\/148\/74205\/74205_cfcbahia.ypdx</code>, 得到<code>.ypdx</code>格式的播放文件</strong></p><p>现在再来通过命令行启动一个VIP乐谱,看看请求和响应会是怎样的</p><p><figure style=flex-grow:253;flex-basis:609px><a href=/posts/hack/xtan/exe/8.jpg data-size=1421x560><img src=/posts/hack/xtan/exe/8.jpg srcset="/posts/hack/xtan/exe/8_hu3f37fa29dc05402f585297533b7b83ee_37005_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/8_hu3f37fa29dc05402f585297533b7b83ee_37005_1024x0_resize_q75_box.jpg 1024w" width=1421 height=560 loading=lazy alt=image-8></a><figcaption>image-8</figcaption></figure></p><p>可以看到这次只有一个<code>m=index</code>的请求, 且返回码不同于免费乐谱的<code>1000</code>, 之后播放器弹出没有权限的弹窗, 那么思路就来了</p><p><strong>如果我将篡改请求的响应,播放器应该就会认为我是有权限的,那不就可以播放了吗?</strong></p><p>首先使用<code>Charles</code>进行断点, 针对<code>m=index</code>的请求, 修改播放器请求VIP乐谱的返回值</p><p><figure style=flex-grow:297;flex-basis:713px><a href=/posts/hack/xtan/exe/9.jpg data-size=1457x490><img src=/posts/hack/xtan/exe/9.jpg srcset="/posts/hack/xtan/exe/9_hu7ca9ec15f72904f15f25adfa64967b6c_45120_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/9_hu7ca9ec15f72904f15f25adfa64967b6c_45120_1024x0_resize_q75_box.jpg 1024w" width=1457 height=490 loading=lazy alt=iamge-9></a><figcaption>iamge-9</figcaption></figure></p><p><strong>和我预料的一样, 修改<code>m=index</code>的响应后, 这次发送了<code>m=getYpdsUrl</code>的请求</strong></p><p>但是<code>m=getYpdsUrl</code>仍然对用户权限进行了判断, 因此返回码不是正常的<code>1000</code>, 且<code>result</code>节点没有返回<code>.ypdx</code>播放文件的资源地址, 看样子不是VIP用户是无法获得资源地址了</p><h1 id=但是>但是</h1><p><strong>在文章 <a class=link href=../xtan_flash_hack/index.md>某乐谱网站Flash播放器破解记录</a> 中, 使用<code>getURL</code>生成的乐谱信息url去请求乐谱服务器得到的返回值里, 是包含<code>.ypa2</code>格式的资源地址的, 只不过现在<code>.ypa2</code>资源已经被删了, 不过观察刚才免费的乐谱<code>.ypdx</code>资源地址后, 会发现这和<code>.ypa2</code>的资源地址高度相似! 于是我将返回的<code>.ypa2</code>资源地址修改后缀名为<code>.ypdx</code>进行请求之后, 顺利得到了<code>.ypdx</code>格式的播放文件!</strong></p><pre><code>//ypa2请求地址
http://oss.马赛克.com/yuepuku/115/57806/57806_hhdafigb.ypa2

//ypdx请求地址
http://oss.马赛克.com/yuepuku/115/57806/57806_hhdafigb.ypdx
</code></pre><p>得到<code>.ypdx</code>文件之后, 开启一个本地HTTP服务器, 开放一个地址用于返回<code>.ypdx</code>文件, 然后用<code>Charles</code>对VIP乐谱请求中<code>m=getYpdsUrl</code>断点, 并修改响应中<code>result</code>里对应的资源地址为本地HTTP服务器地址</p><pre><code>{
    &quot;data&quot;:
    {
        &quot;code&quot;:&quot;1000&quot;,
        &quot;message&quot;:&quot;\u83b7\u53d6\u6210\u529f&quot;,
        &quot;result&quot;:
        {
            &quot;ypdsUrl&quot;:&quot;http:\/\/127.0.0.1:7777\/yuepu\/57806_hhdafigb.ypds&quot;,&quot;ypdxUrl&quot;:&quot;http:\/\/127.0.0.1:7777\/yuepu\/57806_hhdafigb.ypdx&quot;
        }
    }
}
</code></pre><p>再次测试, <strong>成功打开VIP乐谱, 并开始播放, 所有功能正常!</strong></p><p><figure style=flex-grow:172;flex-basis:412px><a href=/posts/hack/xtan/exe/10.jpg data-size=917x533><img src=/posts/hack/xtan/exe/10.jpg srcset="/posts/hack/xtan/exe/10_hud8451ede4dc6fa64d83d0d25cd237bd1_87539_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/10_hud8451ede4dc6fa64d83d0d25cd237bd1_87539_1024x0_resize_q75_box.jpg 1024w" width=917 height=533 loading=lazy alt=image-10></a><figcaption>image-10</figcaption></figure></p><p>确定伪造响应的方案确定可行之后, 下一步就是要让播放器请求我指定的地址了, 因为刚才是通过<code>Charles</code>修改响应的, 但我不可能每次都使用<code>Charles</code>断点, 我需要反编译<code>xxplayer.exe</code>, 并修改服务请求地址为我监听的地址, 然后由我监听的地址返回所需数据</p><p>使用<code>OllyDbg</code>(以下简称<code>OD</code>)反汇编<code>xxplayer.exe</code>, 在菜单栏依次点击 &ldquo;插件&rdquo; -> &ldquo;中文搜索引擎&rdquo; -> &ldquo;搜索UNICODE&rdquo;, 以<code>Charles</code>捕获到的url中的关键字<code>codeindex</code>搜索, 发现一共有三处</p><p><figure style=flex-grow:157;flex-basis:377px><a href=/posts/hack/xtan/exe/11.jpg data-size=873x555><img src=/posts/hack/xtan/exe/11.jpg srcset="/posts/hack/xtan/exe/11_huffee53a5592e1e02a42fb8e5ded3cf0f_112355_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/11_huffee53a5592e1e02a42fb8e5ded3cf0f_112355_1024x0_resize_q75_box.jpg 1024w" width=873 height=555 loading=lazy alt=iamge-11></a><figcaption>iamge-11</figcaption></figure></p><blockquote><p>Warning: 此处我没有使用虚拟机打开, 建议各位反汇编的时候用虚拟机, 因为被反汇编的程序如果有反调试的代码, 轻则闪退重则格盘. 另外<code>OD</code>本身是不带"中文搜索引擎"插件的, 需要自行下载安装</p></blockquote><p>双击搜索到的第一处字符串, 跳转到引用代码段, 通过字符串格式可以看出, 其中<code>%s</code>是要用参数替换的, 且通过前面的<code>push</code>可以看出, 它自身也是作为参数被传递的, 那么只要跟踪下方离他最近的<code>call</code>之前的变量, 就能确定需要修改哪一行了, 在可疑的<code>push</code>处按<code>F2</code>断点, <code>F8</code>单步调试后, 发现<code>push [local.7]</code>正是请求的域名</p><p><figure style=flex-grow:247;flex-basis:593px><a href=/posts/hack/xtan/exe/12.jpg data-size=1382x559><img src=/posts/hack/xtan/exe/12.jpg srcset="/posts/hack/xtan/exe/12_hu2c3187806ba888f67c6ef154a52910a6_103478_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/12_hu2c3187806ba888f67c6ef154a52910a6_103478_1024x0_resize_q75_box.jpg 1024w" width=1382 height=559 loading=lazy alt=image-12></a><figcaption>image-12</figcaption></figure></p><p>为了修改字符串, 有两种方式</p><ol><li>如果修改前后字符串长度相同, 可以直接定位到字符串地址进行修改</li><li>如果长度不同, 可以在程序空白处, 新增一段字符串, 然后将之前对字符串的地址引用改为新增的字符串地址</li></ol><blockquote><p>程序空白处是指在<code>OD</code>左下角的数据面板, 拉到最下面, 可以看到一堆<code>00 00 00 00 00 00 ...</code>, <code>00</code>在汇编中就是啥都没有, 啥都不干, 也就是空白的意思</p></blockquote><p>这里暂时不知道<code>[local.7]</code>哪儿来的, 所以我选择第二种方式, 查看<code>OD</code>左下角数据面板, 拉到最下面, 找到程序空白处, 双击空白地址, 在弹出的编辑窗口中取消勾选"Keep size", 在<code>UNICODE</code>栏输入<code>localhost:7777</code></p><p><figure style=flex-grow:141;flex-basis:338px><a href=/posts/hack/xtan/exe/13.jpg data-size=877x621><img src=/posts/hack/xtan/exe/13.jpg srcset="/posts/hack/xtan/exe/13_hudbbd87ddb0f3a147db74e9958487c023_140223_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/13_hudbbd87ddb0f3a147db74e9958487c023_140223_1024x0_resize_q75_box.jpg 1024w" width=877 height=621 loading=lazy alt=image-13></a><figcaption>image-13</figcaption></figure></p><p><figure style=flex-grow:183;flex-basis:440px><a href=/posts/hack/xtan/exe/14.jpg data-size=674x367><img src=/posts/hack/xtan/exe/14.jpg srcset="/posts/hack/xtan/exe/14_hu04bc64c292e419c662d490484458d11b_82404_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/14_hu04bc64c292e419c662d490484458d11b_82404_1024x0_resize_q75_box.jpg 1024w" width=674 height=367 loading=lazy alt=image-14></a><figcaption>image-14</figcaption></figure></p><blockquote><p>Q1: 为什么不在<code>011808E0</code>行的<code>6C 65 57</code>后面的<code>00</code>处添加, 而是在<code>00</code>的后面?</p><blockquote><p>因为汇编中字符串是以<code>00</code>结尾, 且每个字符后面都跟一个<code>00</code>, 为了尽量避免覆盖前面的数据块, 这里空开一个<code>00</code>位置, 如果前面数据块明显是字符串,需要空开三个<code>00</code>, 因为结束符<code>00</code>后面也会跟一个<code>00</code></p></blockquote></blockquote><blockquote><p>Q2: 为什么取消勾选"Keep size"</p><blockquote><p>Keep size的作用是保持长度字符串长度一致, 因为如果超过原来的长度会造成不可预知的错误, 但是这里是程序空白处, 后面都是空白行, 所以不需要保持长度, 有多少写多少</p></blockquote></blockquote><p>此时点击新增的字符串头<code>6C</code>可以在底部栏看到新字符串的起始地址为<code>0x11808E4</code>, 回到汇编面板, 双击刚才的<code>push [local.7]</code>所在行, 在弹出的面板中修改为 <code>push 0x11808E4</code></p><blockquote><p>由于修改后的代码较之前的代码更少, 需要勾选"Fill with NOP`s"来保持长度一致</p></blockquote><p><figure style=flex-grow:468;flex-basis:1125px><a href=/posts/hack/xtan/exe/15.jpg data-size=661x141><img src=/posts/hack/xtan/exe/15.jpg srcset="/posts/hack/xtan/exe/15_hu57c63b4afeb55ac5b9b491851fbce9ac_27836_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/15_hu57c63b4afeb55ac5b9b491851fbce9ac_27836_1024x0_resize_q75_box.jpg 1024w" width=661 height=141 loading=lazy alt=image-15></a><figcaption>image-15</figcaption></figure></p><p>可以看到在汇编面板右侧已经自动显示了标记, 提示当前<code>push</code>的值为<code>localhost:7777</code></p><p><figure style=flex-grow:494;flex-basis:1187px><a href=/posts/hack/xtan/exe/16.jpg data-size=757x153><img src=/posts/hack/xtan/exe/16.jpg srcset="/posts/hack/xtan/exe/16_hu9bfdeefc21eab2638c1ebf03797105d7_27361_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/16_hu9bfdeefc21eab2638c1ebf03797105d7_27361_1024x0_resize_q75_box.jpg 1024w" width=757 height=153 loading=lazy alt=image-16></a><figcaption>image-16</figcaption></figure></p><p>现在选中刚才在数据面板添加的字符串十六进制代码块, 右键点击"复制到可执行文件", 再选中汇编面板所有修改的行, 右键点击"复制到可执行文件" -> &ldquo;选中行&rdquo;, 在弹出的面板中右键"备份" -> &ldquo;保存数据到文件"即可保存修改后的exe文件</p><p><figure style=flex-grow:169;flex-basis:406px><a href=/posts/hack/xtan/exe/36.jpg data-size=490x289><img src=/posts/hack/xtan/exe/36.jpg srcset="/posts/hack/xtan/exe/36_hu404fc96720b3b7e3a08d11e39c71c904_39522_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/36_hu404fc96720b3b7e3a08d11e39c71c904_39522_1024x0_resize_q75_box.jpg 1024w" width=490 height=289 loading=lazy alt=image-36></a><figcaption>image-36</figcaption></figure></p><p>执行修改后的程序, 发现程序异常退出, 用<code>OD</code>打开修改后的文件, 再次找到刚才修改<code>push</code>的地方, 发现右侧没有显示<code>localhost:7777</code>的标记</p><p><figure style=flex-grow:792;flex-basis:1900px><a href=/posts/hack/xtan/exe/17.jpg data-size=800x101><img src=/posts/hack/xtan/exe/17.jpg srcset="/posts/hack/xtan/exe/17_huf607ca71409b4fad60df0a0bf04883f0_25000_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/17_huf607ca71409b4fad60df0a0bf04883f0_25000_1024x0_resize_q75_box.jpg 1024w" width=800 height=101 loading=lazy alt=image-17></a><figcaption>image-17</figcaption></figure></p><p>再看看跳转地址<code>0x11808E4</code>, 也不是刚才修改的字符串内容</p><p><figure style=flex-grow:223;flex-basis:535px><a href=/posts/hack/xtan/exe/18.jpg data-size=705x316><img src=/posts/hack/xtan/exe/18.jpg srcset="/posts/hack/xtan/exe/18_hu399d950736d8f788e6f1fac9c27f058c_68183_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/18_hu399d950736d8f788e6f1fac9c27f058c_68183_1024x0_resize_q75_box.jpg 1024w" width=705 height=316 loading=lazy alt=image-18></a><figcaption>image-18</figcaption></figure></p><p>虽然不知道为什么, 但是看来<code>push [local.x]</code>形式的代码不能这样简单的修改. 那么换个角度想想<code>[local.7]</code>的值是哪里来的, 这时突然想到播放器启动的时候, 带的参数里是有一个网址的</p><pre><code>file=http://www.马赛克.com/open_yp.php?ypid=73981&amp;uid=999999999&amp;token=fbf0ab24ee47bfa1cb460e41c1f61fdb&amp;ypid=73981
</code></pre><p>我将这个网址修改为百度的网址</p><pre><code>file=http://www.baidu.com/open_yp.php?ypid=73981&amp;uid=999999999&amp;token=fbf0ab24ee47bfa1cb460e41c1f61fdb&amp;ypid=73981
</code></pre><p>重新运行, 抓包发现它真的去请求百度的<code>/codeindex.php</code>接口了</p><p><figure style=flex-grow:246;flex-basis:591px><a href=/posts/hack/xtan/exe/19.jpg data-size=1201x487><img src=/posts/hack/xtan/exe/19.jpg srcset="/posts/hack/xtan/exe/19_hu0b7b1ef1c2d34dbfa1585c7679051785_39521_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/19_hu0b7b1ef1c2d34dbfa1585c7679051785_39521_1024x0_resize_q75_box.jpg 1024w" width=1201 height=487 loading=lazy alt=image-19></a><figcaption>image-19</figcaption></figure></p><p>于是我再将参数换成<code>localhost:7777</code>, 重新运行, 结果发现程序异常退出, 进行跟踪调试发现<code>[local.7]</code>的实际值被截取了不包含端口号的部分, 为<code>localhost</code></p><p><figure style=flex-grow:698;flex-basis:1676px><a href=/posts/hack/xtan/exe/20.jpg data-size=433x62><img src=/posts/hack/xtan/exe/20.jpg srcset="/posts/hack/xtan/exe/20_hu440de6aaab4215e0c9aec32fa24ecc7b_7055_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/20_hu440de6aaab4215e0c9aec32fa24ecc7b_7055_1024x0_resize_q75_box.jpg 1024w" width=433 height=62 loading=lazy alt=image-20></a><figcaption>image-20</figcaption></figure></p><p>尝试跟踪截取部分的代码, 但是太麻烦了决定放弃. 这时候我想到直接将整个url</p><pre><code>%s://%s/codeindex.php?d=api&amp;c=check马赛克playerPower&amp;m=%s&amp;ypid=%d&amp;uid=%d&amp;token=%s
</code></pre><p>中第二个<code>%s</code>直接替换成<code>localhost:7777</code>不就可以了? 但是这样就少了一个<code>%s</code>, 参数对不上后面的代码一定会报错, 于是我想到在<code>?</code>后面再加一个参数, 参数名随意, 参数值就用<code>[local.7]</code>, 反正对于串来说, <code>%s</code>的数量能够对应参数的数量即可, 而对于HTTP请求来说, 多一个参数也没什么影响. 不过修改后字符串的长度就对不上了, 所以还是在程序空白处添加了一个新的字符串如下</p><pre><code>%s://localhost:7777/codeindex.php?a=%s&amp;d=api&amp;c=check马赛克playerPower&amp;m=%s&amp;ypid=%d&amp;uid=%d&amp;token=%s
</code></pre><p><figure style=flex-grow:153;flex-basis:367px><a href=/posts/hack/xtan/exe/21.jpg data-size=889x580><img src=/posts/hack/xtan/exe/21.jpg srcset="/posts/hack/xtan/exe/21_hu1c54f487ac9664d7c79f770f2f649700_141375_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/21_hu1c54f487ac9664d7c79f770f2f649700_141375_1024x0_resize_q75_box.jpg 1024w" width=889 height=580 loading=lazy alt=image-21></a><figcaption>image-21</figcaption></figure></p><p>其中<code>a</code>就是新增的无用参数, <code>a</code>后面跟的<code>%s</code>将会被<code>[local.7]</code>的值替换, 这样一来无论启动参数中的域名是什么都无所谓了. 记录新字符串的地址为<code>0x11808E4</code>, 找到<code>push</code>原来字符串的汇编代码, 修改<code>push</code>地址为新的字符串地址</p><p><figure style=flex-grow:375;flex-basis:901px><a href=/posts/hack/xtan/exe/22.jpg data-size=781x208><img src=/posts/hack/xtan/exe/22.jpg srcset="/posts/hack/xtan/exe/22_hue1957260a927d0c5dbb86391d75e28e1_43919_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/22_hue1957260a927d0c5dbb86391d75e28e1_43919_1024x0_resize_q75_box.jpg 1024w" width=781 height=208 loading=lazy alt=image-22></a><figcaption>image-22</figcaption></figure></p><p>再次保存执行, 程序还是异常退出, 用<code>OD</code>打开修改后的程序发现地址正确, 字符串正确, 但是还是会报错, 于是我怀疑不能用<code>localhost</code>作为域名. 将<code>localhost:7777</code>修改为<code>127.0.0.1:7777</code>, 再次运行, 这次终于在后台收到了来自播放器的HTTP请求!</p><p><figure style=flex-grow:142;flex-basis:341px><a href=/posts/hack/xtan/exe/23.jpg data-size=588x413><img src=/posts/hack/xtan/exe/23.jpg srcset="/posts/hack/xtan/exe/23_hue6d1dcff70949874743239655fec497d_58860_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/23_hue6d1dcff70949874743239655fec497d_58860_1024x0_resize_q75_box.jpg 1024w" width=588 height=413 loading=lazy alt=image-23></a><figcaption>image-23</figcaption></figure></p><p>所有参数也都正常接收, 接下来只要返回正确的响应就行了, 对于<code>m=index</code>的直接返回</p><pre><code>{&quot;responseCode&quot;:&quot;1000&quot;,&quot;message&quot;:&quot;\u6b63\u5e38&quot;,&quot;power&quot;:{&quot;openPower&quot;:&quot;1&quot;,&quot;printPower&quot;:&quot;0&quot;,&quot;printCount&quot;:&quot;30&quot;,&quot;vstPower&quot;:&quot;0&quot;,&quot;pdfPower&quot;:&quot;0&quot;}}
</code></pre><p>对于<code>m=getYpdsUrl</code> 的则返回</p><pre><code>{
    &quot;data&quot;:
    {
        &quot;code&quot;:&quot;1000&quot;,
        &quot;message&quot;:&quot;\u83b7\u53d6\u6210\u529f&quot;,
        &quot;result&quot;:
        {
            &quot;ypdsUrl&quot;:&quot;http:\/\/127.0.0.1:7777\/yuepu\/57806_hhdafigb.ypds&quot;,&quot;ypdxUrl&quot;:&quot;http:\/\/127.0.0.1:7777\/yuepu\/57806_hhdafigb.ypdx&quot;
        }
    }
}
</code></pre><p>然后, 用同样的方式修改搜索<code>codeindex</code>结果中的第二处, 再次运行就能正常播放了.</p><h2 id=继续破解>继续破解</h2><p><strong>现在虽然播放曲谱没有问题了, 但是现在还有如下几个VIP功能用不了, 要白嫖就白嫖到极致</strong></p><p><figure style=flex-grow:143;flex-basis:345px><a href=/posts/hack/xtan/exe/24.jpg data-size=233x162><img src=/posts/hack/xtan/exe/24.jpg srcset="/posts/hack/xtan/exe/24_hu900d4ace8f5f7a408779743848e939c7_8586_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/24_hu900d4ace8f5f7a408779743848e939c7_8586_1024x0_resize_q75_box.jpg 1024w" width=233 height=162 loading=lazy alt=image-24></a><figcaption>image-24</figcaption></figure></p><p>从音源开始下手, 点击"音源&rdquo; -> &ldquo;浏览"后, 播放器弹出没有权限的提示</p><p><figure style=flex-grow:204;flex-basis:491px><a href=/posts/hack/xtan/exe/25.jpg data-size=346x169><img src=/posts/hack/xtan/exe/25.jpg srcset="/posts/hack/xtan/exe/25_hu59dd44e7ae9f17fbaea053064c4a0a8f_7285_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/25_hu59dd44e7ae9f17fbaea053064c4a0a8f_7285_1024x0_resize_q75_box.jpg 1024w" width=346 height=169 loading=lazy alt=image-25></a><figcaption>image-25</figcaption></figure></p><p>查看<code>Charles</code>发现期间并没有发出网络请求, 推测应该是在之前的请求里就响应过了, 这时想到最开始<code>m=index</code>的请求中, <code>power</code>节点有很多为<code>0</code>的字段, 仔细一看这不就是对应的权限吗? 推测权限字段对应关系应该是</p><ul><li><code>openPower</code> 打开的权限</li><li><code>printPower</code> 打印的权限</li><li><code>printCount</code> 可打印的数量</li><li><code>vstPower</code> 使用vst音源的权限</li><li><code>pdfPower</code> 转换pdf的权限</li></ul><p>参考正常响应中<code>openPower</code>为1, 其他的为0, 因此把后台响应中所有为0改为1, 再次点击音源, 发现可以正常选择了</p><pre><code>{&quot;responseCode&quot;:&quot;1000&quot;,&quot;message&quot;:&quot;\u6b63\u5e38&quot;,&quot;power&quot;:{&quot;openPower&quot;:&quot;1&quot;,&quot;printPower&quot;:&quot;1&quot;,&quot;printCount&quot;:&quot;30&quot;,&quot;vstPower&quot;:&quot;1&quot;,&quot;pdfPower&quot;:&quot;1&quot;}}
</code></pre><p><figure style=flex-grow:279;flex-basis:669px><a href=/posts/hack/xtan/exe/26.jpg data-size=960x344><img src=/posts/hack/xtan/exe/26.jpg srcset="/posts/hack/xtan/exe/26_hu1bf099da9e3265a9d42b774a7d669a1d_27932_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/26_hu1bf099da9e3265a9d42b774a7d669a1d_27932_1024x0_resize_q75_box.jpg 1024w" width=960 height=344 loading=lazy alt=image-26></a><figcaption>image-26</figcaption></figure></p><p>接下来看看点击转换PDF功能, 通过<code>Charles</code>发现会发送一个权限请求</p><p><figure style=flex-grow:235;flex-basis:565px><a href=/posts/hack/xtan/exe/27.jpg data-size=1355x575><img src=/posts/hack/xtan/exe/27.jpg srcset="/posts/hack/xtan/exe/27_hu4561b2c4374e5a889b57d6ec9aab22e2_42292_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/27_hu4561b2c4374e5a889b57d6ec9aab22e2_42292_1024x0_resize_q75_box.jpg 1024w" width=1355 height=575 loading=lazy alt=image-27></a><figcaption>image-27</figcaption></figure></p><p>其中接口仍然是<code>/codeindex.php</code>, 但本次<code>m</code>取值为<code>addDynamic</code>, 在<code>OD</code>中发现就是刚才上文<code>codeindex</code>搜索结果中的第三处</p><p><figure style=flex-grow:326;flex-basis:784px><a href=/posts/hack/xtan/exe/28.jpg data-size=1232x377><img src=/posts/hack/xtan/exe/28.jpg srcset="/posts/hack/xtan/exe/28_hu916247033dd02548bff370c15f18cd50_79605_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/28_hu916247033dd02548bff370c15f18cd50_79605_1024x0_resize_q75_box.jpg 1024w" width=1232 height=377 loading=lazy alt=image-28></a><figcaption>image-28</figcaption></figure></p><p>双击搜索结果字符串转到汇编代码,<code>00F63EAE</code> 处的<code>push</code>地址就是将要用来替换成请求域名的参数, 这个地址指向了乐谱网站的域名, 所以这里采用同样的办法, 先在程序空白处添加字符串<code>127.0.0.1:7777</code>, 然后修改<code>push</code>原来串的地址修改为新增的字符串地址</p><p><figure style=flex-grow:121;flex-basis:291px><a href=/posts/hack/xtan/exe/29.jpg data-size=863x711><img src=/posts/hack/xtan/exe/29.jpg srcset="/posts/hack/xtan/exe/29_hu38430dc1e6439a03884f24c857dc3df5_158665_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/29_hu38430dc1e6439a03884f24c857dc3df5_158665_1024x0_resize_q75_box.jpg 1024w" width=863 height=711 loading=lazy alt=image-29></a><figcaption>image-29</figcaption></figure></p><p>重新保存, 然后在乐谱工具中监听这个地址, 并参考<code>m=index</code>的响应以下结果</p><blockquote><p>乐谱工具是我基于<code>C#</code>开发的一款桌面应用, 其中包括乐谱管理功能, 可以管理所有下载的乐谱并调用Flash播放器播放, 同时开启了一个HTTP监听服务, 监听所有来自<code>localhost:7777</code>的HTTP请求</p></blockquote><pre><code>{&quot;data&quot;:{&quot;code&quot;:&quot;1000&quot;,&quot;message&quot;:&quot;\u6b63\u5e38&quot;,&quot;result&quot;:{&quot;printCount&quot;:&quot;30&quot;}}}
</code></pre><p>重新打开运行PDF保存, 发现可以转换并保存了</p><p><figure style=flex-grow:134;flex-basis:323px><a href=/posts/hack/xtan/exe/30.jpg data-size=820x608><img src=/posts/hack/xtan/exe/30.jpg srcset="/posts/hack/xtan/exe/30_hu8e914918ef7e0abf8766f87cc7afd2fe_39001_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/30_hu8e914918ef7e0abf8766f87cc7afd2fe_39001_1024x0_resize_q75_box.jpg 1024w" width=820 height=608 loading=lazy alt=image-30></a><figcaption>image-30</figcaption></figure></p><p>打印的功能和PDF的请求地址和参数<code>m</code>是一样的, 只要返回同样的响应就可以了</p><p><strong>至此VIP功能全部破解</strong></p><h2 id=但是尚不完美>但是尚不完美</h2><p>最后做脱机测试的时候发现播放器会先检查网络连接状态, 没有网络连接则无法播放</p><p><figure style=flex-grow:138;flex-basis:332px><a href=/posts/hack/xtan/exe/31.jpg data-size=234x169><img src=/posts/hack/xtan/exe/31.jpg srcset="/posts/hack/xtan/exe/31_hua7620923e16ce59bf6ec472d077d4bf8_5366_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/31_hua7620923e16ce59bf6ec472d077d4bf8_5366_1024x0_resize_q75_box.jpg 1024w" width=234 height=169 loading=lazy alt=image-31></a><figcaption>image-31</figcaption></figure></p><p>但是我的目标是播放器能够脱机使用, 而且实际上播放器被我修改后已经不需要再连上互联网, 只需要请求乐谱工具的HTTP服务地址就可以, 因此根据弹窗搜索字符串, 定位到相关代码</p><p><figure style=flex-grow:356;flex-basis:854px><a href=/posts/hack/xtan/exe/32.jpg data-size=755x212><img src=/posts/hack/xtan/exe/32.jpg srcset="/posts/hack/xtan/exe/32_huc5c8a523870c7cfbc55a7f4c1592a244_51730_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/32_huc5c8a523870c7cfbc55a7f4c1592a244_51730_1024x0_resize_q75_box.jpg 1024w" width=755 height=212 loading=lazy alt=image-32></a><figcaption>image-32</figcaption></figure></p><p>可以看到播放器在<code>00F693E2</code>处调用系统接口得到网络连接状态, 在<code>00F693EC</code>处, 如果有网络连接则会跳转到<code>00F6940A</code>处继续, 没有网络连接则会显示并中断运行, 那我只需要让这个判断失效就可以了, 双击<code>00F693EC</code>打开编辑窗口, 将<code>jnz</code> (不等于0则跳转) 修改为<code>jmp</code> (无条件跳转), 这样运行至此的时候将不会判断网络连接状态, 直接运行后面的代码</p><p><figure style=flex-grow:258;flex-basis:621px><a href=/posts/hack/xtan/exe/34.jpg data-size=725x280><img src=/posts/hack/xtan/exe/34.jpg srcset="/posts/hack/xtan/exe/34_hu97a16d2494720619905afeac8c214e7e_58677_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/34_hu97a16d2494720619905afeac8c214e7e_58677_1024x0_resize_q75_box.jpg 1024w" width=725 height=280 loading=lazy alt=image-34></a><figcaption>image-34</figcaption></figure></p><p><figure style=flex-grow:424;flex-basis:1018px><a href=/posts/hack/xtan/exe/35.jpg data-size=734x173><img src=/posts/hack/xtan/exe/35.jpg srcset="/posts/hack/xtan/exe/35_hua827e34f01cf28e04ef01c9d17be5ee7_41039_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/35_hua827e34f01cf28e04ef01c9d17be5ee7_41039_1024x0_resize_q75_box.jpg 1024w" width=734 height=173 loading=lazy alt=image-35></a><figcaption>image-35</figcaption></figure></p><p>同样的, 在使用转换PDF功能时还会检测网络状态, 然后弹窗提示"没有检测到网络!&rdquo;, 找到代码运行处, 修改<code>00F75DDE</code>处的<code>jnz</code>为<code>jmp</code>即可</p><p><figure style=flex-grow:529;flex-basis:1271px><a href=/posts/hack/xtan/exe/33.jpg data-size=694x131><img src=/posts/hack/xtan/exe/33.jpg srcset="/posts/hack/xtan/exe/33_huf3b00aaa9378afd32a3c2a50a118f246_35895_480x0_resize_q75_box.jpg 480w, /posts/hack/xtan/exe/33_huf3b00aaa9378afd32a3c2a50a118f246_35895_1024x0_resize_q75_box.jpg 1024w" width=694 height=131 loading=lazy alt=image-33></a><figcaption>image-33</figcaption></figure></p><p>保存后重新运行, 现在脱机情况下播放器能够正常打开并请求乐谱工具的HTTP服务并正常播放乐谱了, 转存PDF文件等VIP功能也能够正常使用</p><h2 id=至此exe版本宣告完美破解>至此exe版本宣告完美破解</h2></section><footer class=article-footer><section class=article-tags><a href=/tags/hack/>Hack</a>
<a href=/tags/assembly/>Assembly</a>
<a href=/tags/.net/>.NET</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2021 Acgnu+</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>