<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="背景 由于某些需要, 进入某大楼的时候必须用他们物业指定的APP刷门禁, 我安装的时候是6.5.0版本, 这会儿启动速度也还可以, 也没太多花里胡哨的功能. 然而没过多久就迎来了一波强制版本更新, 更新后的版本启动速度慢到令人发指, 且增加了商城, 我就怒了, 区区门禁软件竟然这样肆意妄为, 开工!
目标 去除更新检查, 去掉实名认证
 某加在7.0.0版本更名为某品, 破解版本为6.5.0, 在此保持称呼其为某加
 受害者版本 6.5.0
 首页 
开始破解 首先尝试使用Android反编译大杀器Jadx, 打开Jadx, 直接把某加安装包即.apk文件拖进去, 发现软件没有加壳, 可以看到Jadx顺利反编译出了某加的源码
 7.0版本开始APP加了壳, 没记错的话是某数字安全软件的壳, 脱壳过于麻烦于是使用6.5.0版本破解
  JADX-源码 
直接按 Ctrl + S 将源码全部保存, 然后导入IDEA, 开始分析代码
禁用强制升级 首先根据弹窗文字&amp;quot;发现新版本&amp;quot;搜索代码
 更新弹窗 
发现全文匹配的仅有一处, 位于布局文件dialog_check_update.xml
 结果1 
查找使用该布局文件的地方, 仅有一个类UpdateNoticeDialog
 结果2 
查看UpdateNoticeDialog的代码, 可以看出这是一个自定义的对话框, 和APP显示的更新弹出框一致
 结果3 
接着查找使用到了UpdateNoticeDialog类的地方, 发现多处引用
 结果4"><title>某加APP破解去除认证和更新</title><link rel=canonical href=/posts/hack/xplus/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="某加APP破解去除认证和更新"><meta property="og:description" content="背景 由于某些需要, 进入某大楼的时候必须用他们物业指定的APP刷门禁, 我安装的时候是6.5.0版本, 这会儿启动速度也还可以, 也没太多花里胡哨的功能. 然而没过多久就迎来了一波强制版本更新, 更新后的版本启动速度慢到令人发指, 且增加了商城, 我就怒了, 区区门禁软件竟然这样肆意妄为, 开工!
目标 去除更新检查, 去掉实名认证
 某加在7.0.0版本更名为某品, 破解版本为6.5.0, 在此保持称呼其为某加
 受害者版本 6.5.0
 首页 
开始破解 首先尝试使用Android反编译大杀器Jadx, 打开Jadx, 直接把某加安装包即.apk文件拖进去, 发现软件没有加壳, 可以看到Jadx顺利反编译出了某加的源码
 7.0版本开始APP加了壳, 没记错的话是某数字安全软件的壳, 脱壳过于麻烦于是使用6.5.0版本破解
  JADX-源码 
直接按 Ctrl + S 将源码全部保存, 然后导入IDEA, 开始分析代码
禁用强制升级 首先根据弹窗文字&amp;quot;发现新版本&amp;quot;搜索代码
 更新弹窗 
发现全文匹配的仅有一处, 位于布局文件dialog_check_update.xml
 结果1 
查找使用该布局文件的地方, 仅有一个类UpdateNoticeDialog
 结果2 
查看UpdateNoticeDialog的代码, 可以看出这是一个自定义的对话框, 和APP显示的更新弹出框一致
 结果3 
接着查找使用到了UpdateNoticeDialog类的地方, 发现多处引用
 结果4"><meta property="og:url" content="/posts/hack/xplus/"><meta property="og:site_name" content="Acgnu+"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="Hack"><meta property="article:tag" content="Android"><meta property="article:tag" content="Xposed"><meta property="article:published_time" content="2021-06-10T00:50:44+08:00"><meta property="article:modified_time" content="2021-06-10T00:50:44+08:00"><meta property="og:image" content="/posts/hack/xplus/cover.png"><meta name=twitter:title content="某加APP破解去除认证和更新"><meta name=twitter:description content="背景 由于某些需要, 进入某大楼的时候必须用他们物业指定的APP刷门禁, 我安装的时候是6.5.0版本, 这会儿启动速度也还可以, 也没太多花里胡哨的功能. 然而没过多久就迎来了一波强制版本更新, 更新后的版本启动速度慢到令人发指, 且增加了商城, 我就怒了, 区区门禁软件竟然这样肆意妄为, 开工!
目标 去除更新检查, 去掉实名认证
 某加在7.0.0版本更名为某品, 破解版本为6.5.0, 在此保持称呼其为某加
 受害者版本 6.5.0
 首页 
开始破解 首先尝试使用Android反编译大杀器Jadx, 打开Jadx, 直接把某加安装包即.apk文件拖进去, 发现软件没有加壳, 可以看到Jadx顺利反编译出了某加的源码
 7.0版本开始APP加了壳, 没记错的话是某数字安全软件的壳, 脱壳过于麻烦于是使用6.5.0版本破解
  JADX-源码 
直接按 Ctrl + S 将源码全部保存, 然后导入IDEA, 开始分析代码
禁用强制升级 首先根据弹窗文字&amp;quot;发现新版本&amp;quot;搜索代码
 更新弹窗 
发现全文匹配的仅有一处, 位于布局文件dialog_check_update.xml
 结果1 
查找使用该布局文件的地方, 仅有一个类UpdateNoticeDialog
 结果2 
查看UpdateNoticeDialog的代码, 可以看出这是一个自定义的对话框, 和APP显示的更新弹出框一致
 结果3 
接着查找使用到了UpdateNoticeDialog类的地方, 发现多处引用
 结果4"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/posts/hack/xplus/cover.png"><link rel="shortcut icon" href=/favicon.ico></head><body class="article-page keep-sidebar"><script>(function(){const colorSchemeKey='StackColorScheme';if(!localStorage.getItem(colorSchemeKey)){localStorage.setItem(colorSchemeKey,"auto");}})();</script><script>(function(){const colorSchemeKey='StackColorScheme';const colorSchemeItem=localStorage.getItem(colorSchemeKey);const supportDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches===true;if(colorSchemeItem=='dark'||colorSchemeItem==='auto'&&supportDarkMode){document.body.dataset.scheme='dark';}else{document.body.dataset.scheme='light';}})();</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu3a9833e4ebdcf9e444b7caf140fa72b8_113624_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>😎</span></figure><h1 class=site-name><a href=/>Acgnu+</a></h1><h2 class=site-description>時間はいつも足りない</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/hack/xplus/><img src=/posts/hack/xplus/cover_hu3190e2a44b906316a77f497bcfe6cb92_2387451_800x0_resize_box_2.png srcset="/posts/hack/xplus/cover_hu3190e2a44b906316a77f497bcfe6cb92_2387451_800x0_resize_box_2.png 800w, /posts/hack/xplus/cover_hu3190e2a44b906316a77f497bcfe6cb92_2387451_1600x0_resize_box_2.png 1600w" width=800 height=476 loading=lazy alt="Featured image of post 某加APP破解去除认证和更新"></a></div><div class=article-details><header class=article-category><a href=/categories/hack/>Hack</a></header><h2 class=article-title><a href=/posts/hack/xplus/>某加APP破解去除认证和更新</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Jun 10, 2021</time></footer></div></header><section class=article-content><h2 id=背景>背景</h2><p>由于某些需要, 进入某大楼的时候必须用他们物业指定的APP刷门禁, 我安装的时候是6.5.0版本, 这会儿启动速度也还可以, 也没太多花里胡哨的功能. 然而没过多久就迎来了一波强制版本更新, 更新后的版本启动速度慢到令人发指, 且增加了商城, 我就怒了, 区区门禁软件竟然这样肆意妄为, 开工!</p><h2 id=目标>目标</h2><p>去除更新检查, 去掉实名认证</p><blockquote><p>某加在7.0.0版本更名为某品, 破解版本为6.5.0, 在此保持称呼其为某加</p></blockquote><h2 id=受害者版本>受害者版本</h2><p>6.5.0</p><p><figure style=flex-grow:48;flex-basis:116px><a href=/posts/hack/xplus/1.jpg data-size=428x879><img src=/posts/hack/xplus/1.jpg srcset="/posts/hack/xplus/1_hu2d95ec83e3d4d01752f97536c451549d_53428_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/1_hu2d95ec83e3d4d01752f97536c451549d_53428_1024x0_resize_q75_box.jpg 1024w" width=428 height=879 loading=lazy alt=首页></a><figcaption>首页</figcaption></figure></p><h2 id=开始破解>开始破解</h2><p>首先尝试使用Android反编译大杀器<a class=link href=https://github.com/skylot/jadx target=_blank rel=noopener>Jadx</a>, 打开<code>Jadx</code>, 直接把某加安装包即<code>.apk</code>文件拖进去, 发现软件没有加壳, 可以看到<code>Jadx</code>顺利反编译出了某加的源码</p><blockquote><p>7.0版本开始APP加了壳, 没记错的话是某数字安全软件的壳, 脱壳过于麻烦于是使用6.5.0版本破解</p></blockquote><p><figure style=flex-grow:146;flex-basis:350px><a href=/posts/hack/xplus/2.jpg data-size=969x663><img src=/posts/hack/xplus/2.jpg srcset="/posts/hack/xplus/2_hu349652975c97a7c5fc2ef7ec56ba8aea_76881_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/2_hu349652975c97a7c5fc2ef7ec56ba8aea_76881_1024x0_resize_q75_box.jpg 1024w" width=969 height=663 loading=lazy alt=JADX-源码></a><figcaption>JADX-源码</figcaption></figure></p><p>直接按 <code>Ctrl + S</code> 将源码全部保存, 然后导入<code>IDEA</code>, 开始分析代码</p><h2 id=禁用强制升级>禁用强制升级</h2><p>首先根据弹窗文字"发现新版本"搜索代码</p><p><figure style=flex-grow:133;flex-basis:320px><a href=/posts/hack/xplus/3.jpg data-size=516x387><img src=/posts/hack/xplus/3.jpg srcset="/posts/hack/xplus/3_huecfdf6804dc5656d1adc2869cf9b626f_14908_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/3_huecfdf6804dc5656d1adc2869cf9b626f_14908_1024x0_resize_q75_box.jpg 1024w" width=516 height=387 loading=lazy alt=更新弹窗></a><figcaption>更新弹窗</figcaption></figure></p><p>发现全文匹配的仅有一处, 位于布局文件<code>dialog_check_update.xml</code></p><p><figure style=flex-grow:374;flex-basis:897px><a href=/posts/hack/xplus/4.jpg data-size=606x162><img src=/posts/hack/xplus/4.jpg srcset="/posts/hack/xplus/4_hue4475e29c1a510e088031ebe8ac250a6_13878_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/4_hue4475e29c1a510e088031ebe8ac250a6_13878_1024x0_resize_q75_box.jpg 1024w" width=606 height=162 loading=lazy alt=结果1></a><figcaption>结果1</figcaption></figure></p><p>查找使用该布局文件的地方, 仅有一个类<code>UpdateNoticeDialog</code></p><p><figure style=flex-grow:327;flex-basis:786px><a href=/posts/hack/xplus/5.jpg data-size=845x258><img src=/posts/hack/xplus/5.jpg srcset="/posts/hack/xplus/5_hua4120d517d4567fa7454cfab4a402f5d_39648_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/5_hua4120d517d4567fa7454cfab4a402f5d_39648_1024x0_resize_q75_box.jpg 1024w" width=845 height=258 loading=lazy alt=结果2></a><figcaption>结果2</figcaption></figure></p><p>查看<code>UpdateNoticeDialog</code>的代码, 可以看出这是一个自定义的对话框, 和APP显示的更新弹出框一致</p><p><figure style=flex-grow:264;flex-basis:633px><a href=/posts/hack/xplus/6.jpg data-size=470x178><img src=/posts/hack/xplus/6.jpg srcset="/posts/hack/xplus/6_hue4b7d0705f3de3ef847d77bbc0819788_12612_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/6_hue4b7d0705f3de3ef847d77bbc0819788_12612_1024x0_resize_q75_box.jpg 1024w" width=470 height=178 loading=lazy alt=结果3></a><figcaption>结果3</figcaption></figure></p><p>接着查找使用到了<code>UpdateNoticeDialog</code>类的地方, 发现多处引用</p><p><figure style=flex-grow:236;flex-basis:567px><a href=/posts/hack/xplus/7.jpg data-size=605x256><img src=/posts/hack/xplus/7.jpg srcset="/posts/hack/xplus/7_hu6e22dec133ef02ae33ed651f7531c52c_26368_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/7_hu6e22dec133ef02ae33ed651f7531c52c_26368_1024x0_resize_q75_box.jpg 1024w" width=605 height=256 loading=lazy alt=结果4></a><figcaption>结果4</figcaption></figure></p><p>而APP弹出更新提示的时候, 我正位于APP的首页, 可以推断出<code>HomeActivity</code>应该就是我要寻找的弹框处, 查看<code>HomeActivity</code>的代码如下</p><p><figure style=flex-grow:108;flex-basis:261px><a href=/posts/hack/xplus/8.jpg data-size=800x735><img src=/posts/hack/xplus/8.jpg srcset="/posts/hack/xplus/8_hu0d04ef7bf6568aeec0b7dc1a72e4ac07_78371_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/8_hu0d04ef7bf6568aeec0b7dc1a72e4ac07_78371_1024x0_resize_q75_box.jpg 1024w" width=800 height=735 loading=lazy alt=首页></a><figcaption>首页</figcaption></figure></p><p>可以看到这里将<code>UpdateNoticeDialog</code>定义为成员变量, 然后在<code>checkUpdate</code>中对<code>UpdateNoticeDialog</code>赋值, 且其他操作都位于<code>checkUpdate</code>中, 现在看看<code>checkUpdate</code>完整代码如下</p><p><figure style=flex-grow:140;flex-basis:338px><a href=/posts/hack/xplus/9.jpg data-size=710x504><img src=/posts/hack/xplus/9.jpg srcset="/posts/hack/xplus/9_hu0a58a8411c4b0c4596961a24b6ef84f2_53536_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/9_hu0a58a8411c4b0c4596961a24b6ef84f2_53536_1024x0_resize_q75_box.jpg 1024w" width=710 height=504 loading=lazy alt=检查更新></a><figcaption>检查更新</figcaption></figure></p><p>这个方法并没有做除了更新检查以外的事, 那么我只需要在<code>Xposed</code>中替换这个方法就可以了, 这样当APP调用<code>checkUpdate</code>时, 将执行我定义的方法, <code>Xposed</code>模块代码如下</p><pre><code>findAndHookMethod(&quot;com.马赛克.马赛克.home.HomeActivity&quot;, loadPackageParam.classLoader,
    &quot;checkUpdate&quot;,
    new XC_MethodReplacement() {
        @Override
        protected Object replaceHookedMethod(MethodHookParam param) throws Throwable {
            return null;
        }
    });
</code></pre><p>这里直接使用<code>replaceHookedMethod</code>, 用自己定义的方法代替<code>checkUpdate</code>执行, <strong>写好后重新运行可以发现首页更新弹窗已经被屏蔽了.</strong></p><p>然而后来手贱不小心退出登录了, 再启动APP时发现登录的时候也有更新认证, 现在可行的方法有二, 一是找到登录界面, 用同样的方法去除更新, 但是这样一来繁琐, 二来他可能还有其他的地方有更新检查, 所以使用第二种方法</p><p>根据Android开发文档可以得知, <strong>可以在APP的<code>AndroidManifest.xml</code>中可以定义当前APP的版本号, 然后可以在<code>Java</code>代码中使用<code>PackageInfo</code>来获得当前APP的版本信息, 而定义版本主要分为版本号<code>versionCode</code>和版本名<code>versionName</code>, 一般使用<code>versionCode</code>大小来判断是否需要更新, 而<code>versionName</code>则主要用作展示</strong>, 查看某加APP的<code>AndroidManifest.xml</code>文件, 发现其版本定义如下</p><p><figure style=flex-grow:451;flex-basis:1082px><a href=/posts/hack/xplus/10.jpg data-size=546x121><img src=/posts/hack/xplus/10.jpg srcset="/posts/hack/xplus/10_hu96277694f98aa3c45610a16b3673614a_9450_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/10_hu96277694f98aa3c45610a16b3673614a_9450_1024x0_resize_q75_box.jpg 1024w" width=546 height=121 loading=lazy alt=版本></a><figcaption>版本</figcaption></figure></p><p>那么一般的做法只要将<code>versionCode</code>的值修改成足够大, 就能达到免更新的目的, 但是实际操作下来发现这APP比较鸡贼, 判断版本是否更新并不是简单通过<code>versionCode</code>大小来判断, 不过当时为了偷懒也没有进一步分析版本检查代码, 我只知道最新版本的<code>versionName</code>是7.0.0, 所以直接使用<code>Xposed</code>将返回的<code>versionName</code>修改为固定的7.0.0</p><pre><code>findAndHookMethod(&quot;android.app.ApplicationPackageManager&quot;, loadPackageParam.classLoader,
    &quot;getPackageInfo&quot;,
    String.class,
    int.class,
    new XC_MethodHook() {
        @Override
        protected void afterHookedMethod(MethodHookParam param) throws Throwable {
        PackageInfo packageInfo = (PackageInfo) param.getResult();
        if (null != packageInfo &amp;&amp; getTargetPackage().equals(packageInfo.packageName)) {
                packageInfo.versionCode = Integer.MAX_VALUE;
                packageInfo.versionName = &quot;7.0.0&quot;;
            }
        }
    });
</code></pre><p>此处使用<code>Xposed</code>直接拦截Android系统的包管理器, 当某加需要获取版本名时, 直接返回7.0.0, 不过这样做的缺点是如果某加未来版本更新到7.0.0以上时, 需要修改代码, 然而从2020年12月破解至今, 某加都没有再发布过版本更新, 省了我不少事</p><p><strong>至此重新打包运行, 发现登录的更新检查也被去除了</strong></p><p>然而新的风暴又出现了, 由于刚才的不慎退出, 现在需要重新上传实名认证资料了, 包括身份证号和照片, 由于我之前已经填过一次, 而且上传后需要重新审核, 所以不愿意再次填写, 于是开始寻找认证部分的代码</p><h2 id=跳过实名认证>跳过实名认证</h2><p>认证弹窗如下</p><p><figure style=flex-grow:56;flex-basis:136px><a href=/posts/hack/xplus/11.jpg data-size=530x931><img src=/posts/hack/xplus/11.jpg srcset="/posts/hack/xplus/11_hu96f99dea830a15ed6bd30d3c0d69bfe0_47957_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/11_hu96f99dea830a15ed6bd30d3c0d69bfe0_47957_1024x0_resize_q75_box.jpg 1024w" width=530 height=931 loading=lazy alt=实名认证弹窗></a><figcaption>实名认证弹窗</figcaption></figure></p><p>当我点击右下角的显示门禁卡二维码按钮的时候, 就会弹出认证弹窗, 我们知道<code>Activity</code>会通过<code>setContentView</code>加载一个布局文件, 此页面为APP首页, 所以在<code>HomeActivity</code>中搜索<code>setContentView</code>, 发现并没有结果</p><p><figure style=flex-grow:318;flex-basis:765px><a href=/posts/hack/xplus/12.jpg data-size=679x213><img src=/posts/hack/xplus/12.jpg srcset="/posts/hack/xplus/12_hu82614e200c2ca9e6d3cff5f090370c74_23860_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/12_hu82614e200c2ca9e6d3cff5f090370c74_23860_1024x0_resize_q75_box.jpg 1024w" width=679 height=213 loading=lazy alt=首页2></a><figcaption>首页2</figcaption></figure></p><p>但是<code>HomeActivity</code>继承自<code>BaseActivity_2019_8_22</code>, 于是在父类中找到了<code>setContentView</code></p><p><figure style=flex-grow:251;flex-basis:602px><a href=/posts/hack/xplus/13.jpg data-size=663x264><img src=/posts/hack/xplus/13.jpg srcset="/posts/hack/xplus/13_huc3f0c228985f9b08ea6c4fb72996e418_31164_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/13_huc3f0c228985f9b08ea6c4fb72996e418_31164_1024x0_resize_q75_box.jpg 1024w" width=663 height=264 loading=lazy alt=设置布局></a><figcaption>设置布局</figcaption></figure></p><p>可以看到这里加载的布局是<code>activity_only_linear_layout.xml</code>, 查看这个布局文件, 里面的代码非常简单</p><p><figure style=flex-grow:332;flex-basis:798px><a href=/posts/hack/xplus/14.jpg data-size=892x268><img src=/posts/hack/xplus/14.jpg srcset="/posts/hack/xplus/14_hu18df4b0c8e4b20856bb7a5a1a40ccba6_38292_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/14_hu18df4b0c8e4b20856bb7a5a1a40ccba6_38292_1024x0_resize_q75_box.jpg 1024w" width=892 height=268 loading=lazy alt=布局></a><figcaption>布局</figcaption></figure></p><p>根据名称可以很容易的推断出id为<code>fab_show_qr_code</code>的按钮组件就是首页显示二维码的组件, 搜索这个id查看他的点击事件</p><p><figure style=flex-grow:143;flex-basis:344px><a href=/posts/hack/xplus/15.jpg data-size=724x504><img src=/posts/hack/xplus/15.jpg srcset="/posts/hack/xplus/15_hub70308bebefecd263604d35c1664b3cc_48846_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/15_hub70308bebefecd263604d35c1664b3cc_48846_1024x0_resize_q75_box.jpg 1024w" width=724 height=504 loading=lazy alt=点击事件></a><figcaption>点击事件</figcaption></figure></p><p>根据判断逻辑, 如果<code>CacheUtils.getStatus()</code>返回为1, 就展示二维码弹窗, 不为1则执行<code>checkStatus()</code>, 以防万一, 看看<code>checkStatus()</code>的代码如下</p><p><figure style=flex-grow:390;flex-basis:936px><a href=/posts/hack/xplus/16.jpg data-size=730x187><img src=/posts/hack/xplus/16.jpg srcset="/posts/hack/xplus/16_hu30e72add66bab6b7193b471be38a9d9a_17295_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/16_hu30e72add66bab6b7193b471be38a9d9a_17295_1024x0_resize_q75_box.jpg 1024w" width=730 height=187 loading=lazy alt=检查状态></a><figcaption>检查状态</figcaption></figure></p><p>显然<code>checkIdentityStatus()</code>这名字就很直白的告诉我这个就是用来检查身份认证的了, 在回来看看<code>CacheUtils.getStatus()</code>代码如下</p><p><figure style=flex-grow:294;flex-basis:706px><a href=/posts/hack/xplus/17.jpg data-size=645x219><img src=/posts/hack/xplus/17.jpg srcset="/posts/hack/xplus/17_hub29dfd1774778c08e0d4594a749914d2_20243_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/17_hub29dfd1774778c08e0d4594a749914d2_20243_1024x0_resize_q75_box.jpg 1024w" width=645 height=219 loading=lazy alt=获取状态></a><figcaption>获取状态</figcaption></figure></p><p>这里的逻辑也很简单, 就是从登录信息中获取认证状态, 那么我只要用<code>Xposed</code>将<code>getStatus()</code>的返回值修改为1就可以了, <code>Xposed</code>代码如下</p><pre><code>findAndHookMethod(&quot;com.excegroup.community.utils.CacheUtils&quot;, loadPackageParam.classLoader, &quot;getStatus&quot;,
    String.class,
    new XC_MethodHook() {
        @Override
        protected void afterHookedMethod(MethodHookParam param) throws Throwable {
            param.setResult(&quot;1&quot;);
        }
    });
</code></pre><p>拦截代码将在<code>getStatus()</code>执行之后执行, 将其返回值为修改为1, 现在重新运行, <strong>程序一切正常, 也没有身份认证弹窗了, 点击显示二维码按钮正常显示门禁二维码</strong></p><p><figure style=flex-grow:64;flex-basis:155px><a href=/posts/hack/xplus/18.jpg data-size=524x811><img src=/posts/hack/xplus/18.jpg srcset="/posts/hack/xplus/18_hu8be23d8c5d36ba9786790ce525914933_44600_480x0_resize_q75_box.jpg 480w, /posts/hack/xplus/18_hu8be23d8c5d36ba9786790ce525914933_44600_1024x0_resize_q75_box.jpg 1024w" width=524 height=811 loading=lazy alt=ok></a><figcaption>ok</figcaption></figure></p></section><footer class=article-footer><section class=article-tags><a href=/tags/hack/>Hack</a>
<a href=/tags/android/>Android</a>
<a href=/tags/xposed/>Xposed</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2021 Acgnu+</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>