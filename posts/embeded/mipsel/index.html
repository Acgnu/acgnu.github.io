<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="目录  硬件准备 Windows上的开发环境准备 使用Ubuntu安装MIPSEL架构的交叉编译器 使用C编写Hello Word!测试 遇到的问题 一点感想  硬件准备  一台基于Linux内核, 采用MIPS处理器的设备, 例如我的小米AC2100, Padavan系统 一台支持Windows子系统(WSL)的Windows 10的电脑  Windows上的开发环境准备  安装Visual Studio 2019.9 或以上版本 添加Linux开发环境工具集 (安装时已勾选的可跳过)  在开始菜单中打开「Visual Studio Installer」 找到Visual Studio 2019, 点击右侧的「修改」按钮 找到「使用C++的Linux开发」, 并勾选保存   开启Windows子系统(WSL)并安装Ubuntu, 如何启用Win10的WSL?
安装好后, 以下可按需修改  修改root密码 设置默认以root启动 修改镜像源   为Visual Studio配置跨平台编译
具体配置方式可参考微软官方教程  如何在Visual Studio 2019中配置WSL交叉编译环境? 如何在Visual Studio 2022中配置WSL交叉编译环境?
需要注意的是, 开始菜单中直接搜索「wsl」可以打开一个命令窗口执行Linux命令, 而打开Ubuntu窗口也可以执行命令, 我是在Ubutnu中安装的编译工具, 因此在Visual Studio的「WSL-GCC-Debug」配置中, 「WSL」一栏需要选「Ubuntu2204」  WSL配置     使用Ubuntu安装MIPSEL交叉编译器 在Ubuntu中执行下列命令"><title>在Windows上使用基于WSL的Ubuntu搭建MIPSEL处理器的C语言交叉编译环境</title><link rel=canonical href=/posts/embeded/mipsel/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="在Windows上使用基于WSL的Ubuntu搭建MIPSEL处理器的C语言交叉编译环境"><meta property="og:description" content="目录  硬件准备 Windows上的开发环境准备 使用Ubuntu安装MIPSEL架构的交叉编译器 使用C编写Hello Word!测试 遇到的问题 一点感想  硬件准备  一台基于Linux内核, 采用MIPS处理器的设备, 例如我的小米AC2100, Padavan系统 一台支持Windows子系统(WSL)的Windows 10的电脑  Windows上的开发环境准备  安装Visual Studio 2019.9 或以上版本 添加Linux开发环境工具集 (安装时已勾选的可跳过)  在开始菜单中打开「Visual Studio Installer」 找到Visual Studio 2019, 点击右侧的「修改」按钮 找到「使用C++的Linux开发」, 并勾选保存   开启Windows子系统(WSL)并安装Ubuntu, 如何启用Win10的WSL?
安装好后, 以下可按需修改  修改root密码 设置默认以root启动 修改镜像源   为Visual Studio配置跨平台编译
具体配置方式可参考微软官方教程  如何在Visual Studio 2019中配置WSL交叉编译环境? 如何在Visual Studio 2022中配置WSL交叉编译环境?
需要注意的是, 开始菜单中直接搜索「wsl」可以打开一个命令窗口执行Linux命令, 而打开Ubuntu窗口也可以执行命令, 我是在Ubutnu中安装的编译工具, 因此在Visual Studio的「WSL-GCC-Debug」配置中, 「WSL」一栏需要选「Ubuntu2204」  WSL配置     使用Ubuntu安装MIPSEL交叉编译器 在Ubuntu中执行下列命令"><meta property="og:url" content="/posts/embeded/mipsel/"><meta property="og:site_name" content="Acgnu+"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="Embeded"><meta property="article:tag" content="MIPSEL"><meta property="article:tag" content="WSL"><meta property="article:tag" content="Padavan"><meta property="article:tag" content="Linux"><meta property="article:tag" content="C"><meta property="article:published_time" content="2023-03-03T00:50:44+08:00"><meta property="article:modified_time" content="2023-03-03T00:50:44+08:00"><meta property="og:image" content="/posts/embeded/mipsel/cover.png"><meta name=twitter:title content="在Windows上使用基于WSL的Ubuntu搭建MIPSEL处理器的C语言交叉编译环境"><meta name=twitter:description content="目录  硬件准备 Windows上的开发环境准备 使用Ubuntu安装MIPSEL架构的交叉编译器 使用C编写Hello Word!测试 遇到的问题 一点感想  硬件准备  一台基于Linux内核, 采用MIPS处理器的设备, 例如我的小米AC2100, Padavan系统 一台支持Windows子系统(WSL)的Windows 10的电脑  Windows上的开发环境准备  安装Visual Studio 2019.9 或以上版本 添加Linux开发环境工具集 (安装时已勾选的可跳过)  在开始菜单中打开「Visual Studio Installer」 找到Visual Studio 2019, 点击右侧的「修改」按钮 找到「使用C++的Linux开发」, 并勾选保存   开启Windows子系统(WSL)并安装Ubuntu, 如何启用Win10的WSL?
安装好后, 以下可按需修改  修改root密码 设置默认以root启动 修改镜像源   为Visual Studio配置跨平台编译
具体配置方式可参考微软官方教程  如何在Visual Studio 2019中配置WSL交叉编译环境? 如何在Visual Studio 2022中配置WSL交叉编译环境?
需要注意的是, 开始菜单中直接搜索「wsl」可以打开一个命令窗口执行Linux命令, 而打开Ubuntu窗口也可以执行命令, 我是在Ubutnu中安装的编译工具, 因此在Visual Studio的「WSL-GCC-Debug」配置中, 「WSL」一栏需要选「Ubuntu2204」  WSL配置     使用Ubuntu安装MIPSEL交叉编译器 在Ubuntu中执行下列命令"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/posts/embeded/mipsel/cover.png"><link rel="shortcut icon" href=/favicon.ico></head><body class="article-page keep-sidebar"><script>(function(){const colorSchemeKey='StackColorScheme';if(!localStorage.getItem(colorSchemeKey)){localStorage.setItem(colorSchemeKey,"auto");}})();</script><script>(function(){const colorSchemeKey='StackColorScheme';const colorSchemeItem=localStorage.getItem(colorSchemeKey);const supportDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches===true;if(colorSchemeItem=='dark'||colorSchemeItem==='auto'&&supportDarkMode){document.body.dataset.scheme='dark';}else{document.body.dataset.scheme='light';}})();</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu3a9833e4ebdcf9e444b7caf140fa72b8_113624_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>😎</span></figure><h1 class=site-name><a href=/>Acgnu+</a></h1><h2 class=site-description>時間はいつも足りない</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/embeded/mipsel/><img src=/posts/embeded/mipsel/cover_hu7d17bde0146cbb763a18c7e5ec702040_147670_800x0_resize_box_2.png srcset="/posts/embeded/mipsel/cover_hu7d17bde0146cbb763a18c7e5ec702040_147670_800x0_resize_box_2.png 800w, /posts/embeded/mipsel/cover_hu7d17bde0146cbb763a18c7e5ec702040_147670_1600x0_resize_box_2.png 1600w" width=800 height=446 loading=lazy alt="Featured image of post 在Windows上使用基于WSL的Ubuntu搭建MIPSEL处理器的C语言交叉编译环境"></a></div><div class=article-details><header class=article-category><a href=/categories/embeded/>Embeded</a></header><h2 class=article-title><a href=/posts/embeded/mipsel/>在Windows上使用基于WSL的Ubuntu搭建MIPSEL处理器的C语言交叉编译环境</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Mar 03, 2023</time></footer></div></header><section class=article-content><h2 id=目录>目录</h2><ol><li><a class=link href=#1>硬件准备</a></li><li><a class=link href=#2>Windows上的开发环境准备</a></li><li><a class=link href=#3>使用Ubuntu安装MIPSEL架构的交叉编译器</a></li><li><a class=link href=#4>使用C编写Hello Word!测试</a></li><li><a class=link href=#5>遇到的问题</a></li><li><a class=link href=#6>一点感想</a></li></ol><h2 id=1>硬件准备</h2><ul><li>一台基于Linux内核, 采用MIPS处理器的设备, 例如我的小米AC2100, Padavan系统</li><li>一台支持Windows子系统(WSL)的Windows 10的电脑</li></ul><h2 id=2>Windows上的开发环境准备</h2><ol><li><strong>安装<a class=link href=https://visualstudio.microsoft.com/zh-hans/ target=_blank rel=noopener>Visual Studio</a> 2019.9 或以上版本</strong></li><li><strong><a class=link href=https://www.cnblogs.com/MIUMIUBLING/p/16566200.html target=_blank rel=noopener>添加Linux开发环境工具集</a> (安装时已勾选的可跳过)</strong><ol><li>在开始菜单中打开「Visual Studio Installer」</li><li>找到Visual Studio 2019, 点击右侧的「修改」按钮</li><li>找到「使用C++的Linux开发」, 并勾选保存</li></ol></li><li><strong>开启Windows子系统(WSL)并安装Ubuntu, <a class=link href=https://blog.csdn.net/VXzhangkaiOsLab/article/details/128205285 target=_blank rel=noopener>如何启用Win10的WSL?</a></strong><br>安装好后, 以下可<strong>按需</strong>修改<ul><li><a class=link href=https://blog.csdn.net/ximaiyao1984/article/details/128593271 target=_blank rel=noopener>修改root密码</a></li><li><a class=link href=https://www.cnblogs.com/oongxu/p/16911759.html target=_blank rel=noopener>设置默认以root启动</a></li><li><a class=link href=https://blog.csdn.net/Erictr/article/details/121729194 target=_blank rel=noopener>修改镜像源</a></li></ul></li><li><strong>为<a class=link href=https://visualstudio.microsoft.com/zh-hans/ target=_blank rel=noopener>Visual Studio</a>配置跨平台编译</strong><br>具体配置方式可参考微软官方教程<ul><li><a class=link href=hhttps://devblogs.microsoft.com/cppblog/c-with-visual-studio-2019-and-windows-subsystem-for-linux-wsl/>如何在Visual Studio 2019中配置WSL交叉编译环境?</a></li><li><a class=link href="https://learn.microsoft.com/zh-cn/cpp/build/walkthrough-build-debug-wsl2?view=msvc-170" target=_blank rel=noopener>如何在Visual Studio 2022中配置WSL交叉编译环境?</a><br><strong>需要注意的是, 开始菜单中直接搜索「wsl」可以打开一个命令窗口执行Linux命令, 而打开Ubuntu窗口也可以执行命令, 我是在Ubutnu中安装的编译工具, 因此在<a class=link href=https://visualstudio.microsoft.com/zh-hans/ target=_blank rel=noopener>Visual Studio</a>的「WSL-GCC-Debug」配置中, 「WSL」一栏需要选「Ubuntu2204」</strong><figure style=flex-grow:228;flex-basis:547px><a href=/posts/embeded/mipsel/wslconf.png data-size=1080x473><img src=/posts/embeded/mipsel/wslconf.png srcset="/posts/embeded/mipsel/wslconf_hu2ff68bc45ab4971343be632267931eef_61038_480x0_resize_box_2.png 480w, /posts/embeded/mipsel/wslconf_hu2ff68bc45ab4971343be632267931eef_61038_1024x0_resize_box_2.png 1024w" width=1080 height=473 loading=lazy alt=WSL配置></a><figcaption>WSL配置</figcaption></figure></li></ul></li></ol><h2 id=3>使用Ubuntu安装MIPSEL交叉编译器</h2><p>在Ubuntu中执行下列命令</p><pre><code>apt update   
apt -y install gcc-mipsel-linux-gnu qemu qemu-user 
</code></pre><p>等待安装完毕后, 就可以使用 <code>mipsel-linux-gnu-gcc</code> 命令了</p><p>补充说明:</p><ul><li>建议更换阿里或清华镜像源后执行, 提升下载速度</li><li>「gcc-mipsel-linux-gnu」是交叉编译器, 可将C语言源文件编译成MIPS处理器支持的可执行文件, 如果需要编译C++, 还需安装「g++-mipsel-linux-gnu」</li><li>「qemu」是仿真器, 可以在Ubuntu上模拟运行MIPS架构程序, 节约测试时间</li><li>MIPS可执行文件分为大端(big-endian)和小端(little-endian), 两者的可执行文件不能互相兼容, 通常以mips代指大端, mipsel代指小端</li></ul><p>参考资料:<br><a class=link href=https://noobient.com/2020/12/22/mips-cross-compilation-crash-course/ target=_blank rel=noopener>MIPS跨平台编译教程</a><br><a class=link href=https://www.howtoinstall.me/ubuntu/18-04/gcc-mipsel-linux-gnu/ target=_blank rel=noopener>Ubuntu中如何安装 gcc-mipsel-linux-gnu</a><br><a class=link href="https://baike.baidu.com/item/QEMU/1311178?fr=aladdin" target=_blank rel=noopener>QEMU简介</a></p><h2 id=4>使用C编写Hello Word!测试</h2><p>回到<a class=link href=https://visualstudio.microsoft.com/zh-hans/ target=_blank rel=noopener>Visual Studio</a>中, 在项目里创建源文件<strong>hello.c</strong>并编写helloword测试代码, 编写完后可以通过以下三种方式运行</p><p><strong>1. 直接在Visual Studio中运行</strong><br>可以直接在<a class=link href=https://visualstudio.microsoft.com/zh-hans/ target=_blank rel=noopener>Visual Studio</a>中启动运行或调试, <a class=link href=https://visualstudio.microsoft.com/zh-hans/ target=_blank rel=noopener>Visual Studio</a>会自动将源代码在WSL中编译并运行, 并打开一个控制台输出结果, 方便快速预览效果以及调试</p><p><strong>2. 在qemu中模拟运行</strong><br>使用qemu可以模拟在路由器中运行, 首先需要在Ubuntu中将源代码编译成可执行文件, 我们可以在Ubuntu中导航到<strong>源文件目录</strong>并执行命令</p><pre><code>mipsel-linux-gnu-gcc hello.c -o hello -static
</code></pre><p>编译得到可执行文件<strong>hello</strong>, 再通过 <code>qemu-mipsel</code> 命令预览效果, 如下</p><pre><code>$ qemu-mipsel -L /usr/mipsel-linux-gnu hello
Hello World !
</code></pre><p><strong>3. 使用路由器运行</strong><br>参考上文「<em><strong>2. 在qemu中模拟运行</strong></em>」生成可执行文件<strong>hello</strong>, 再使用<a class=link href=https://winscp.net/eng/download.php target=_blank rel=noopener>WinSCP</a>将其上传至路由器 <code>/var</code> 目录, 然后SSH到路由器执行以下命令运行并查看结果</p><pre><code>chmod u+x ./var/hello
./var/hello
</code></pre><p><figure style=flex-grow:377;flex-basis:905px><a href=/posts/embeded/mipsel/hello.png data-size=249x66><img src=/posts/embeded/mipsel/hello.png srcset="/posts/embeded/mipsel/hello_hua744cf37185bcafc47f58974947343cc_14186_480x0_resize_box_2.png 480w, /posts/embeded/mipsel/hello_hua744cf37185bcafc47f58974947343cc_14186_1024x0_resize_box_2.png 1024w" width=249 height=66 loading=lazy alt=运行结果></a><figcaption>运行结果</figcaption></figure></p><p>补充说明:</p><ul><li>在基于WSL的Ubuntu中, 可以通过路径 <strong>/mnt/Windows盘符/Windows路径</strong> 的方式便捷的访问Windows上的文件, 例如 <code>cd /mnt/c/Windows</code></li><li><code>mipsel-linux-gnu-gcc</code> 中 <code>-static</code> 可以将所需要的库一起打包, 缺点是导致文件体积偏大, 优点是可以确保目标系统能够在缺少动态链接库的情况下运行</li><li><code>qemu-mipsel</code> 中 <code>-L</code> 指定运行库路径, 位于Ubuntu的「/usr/mipsel-linux-gnu」目录中</li></ul><h2 id=5>过程中遇到的问题</h2><ol><li><p><a class=link href=https://visualstudio.microsoft.com/zh-hans/ target=_blank rel=noopener>Visual Studio</a>配置好WSL后, 直接F5编译运行出错, 弹窗提示「<font color=red>Launch options string provided by the project system is invalid. Required attribute &lsquo;program&rsquo; is missing or has an invalid value.</font> 」</p><p>原因是<a class=link href=https://visualstudio.microsoft.com/zh-hans/ target=_blank rel=noopener>Visual Studio</a>版本过低(一开始用的2019.6), 更新到2019.16.11.24之后再运行就好了<br>参考资料: <a class=link href=https://developercommunity.visualstudio.com/t/wsl-cmake-debugging-does-not-work/1205601 target=_blank rel=noopener>Exception from HRESULT: 0x80004004 (E_ABORT)</a></p></li><li><p><a class=link href=https://visualstudio.microsoft.com/zh-hans/ target=_blank rel=noopener>Visual Studio</a>跨平台连接管理器无法连接到Ubuntu<figure style=flex-grow:153;flex-basis:369px><a href=/posts/embeded/mipsel/vsssh.png data-size=738x480><img src=/posts/embeded/mipsel/vsssh.png srcset="/posts/embeded/mipsel/vsssh_hu83c9af1093391170c583cb748fe4ef33_42820_480x0_resize_box_2.png 480w, /posts/embeded/mipsel/vsssh_hu83c9af1093391170c583cb748fe4ef33_42820_1024x0_resize_box_2.png 1024w" width=738 height=480 loading=lazy alt=vs远程连接></a><figcaption>vs远程连接</figcaption></figure>首先 <strong>基于本机WSL开发并不需要配置远程调试</strong>, 以往没有WSL的时候, 通过虚拟机或服务器的Linux跨平台开发时才需要配置. 如果依然希望使用远程调试本机WSL, 则需要配置WSL Ubuntu的openSSH, 更换SSH端口, 开启允许root登录, 然后重启ssh服务即可<br>参考资料: <a class=link href=http://www.360doc.com/content/22/0523/15/65840129_1032775434.shtml target=_blank rel=noopener>如何通过SSH连接到WSL?</a></p></li><li><p>WinSCP无法复制文件到路由器「<font color=red>Error code: 4</font>」</p><p><figure style=flex-grow:211;flex-basis:507px><a href=/posts/embeded/mipsel/sshfail.png data-size=501x237><img src=/posts/embeded/mipsel/sshfail.png srcset="/posts/embeded/mipsel/sshfail_huc3a69099e5dcb6d270a8fe227416313f_61780_480x0_resize_box_2.png 480w, /posts/embeded/mipsel/sshfail_huc3a69099e5dcb6d270a8fe227416313f_61780_1024x0_resize_box_2.png 1024w" width=501 height=237 loading=lazy alt=winscp></a><figcaption>winscp</figcaption></figure><br>因为一开始是复制到 <code>/user</code> 目录, 但此目录空间满了, 后来复制到 <code>/var</code> 就成功了, 可以在根目录使用 <code>df</code> 命令查看空间占用率<br><figure style=flex-grow:419;flex-basis:1006px><a href=/posts/embeded/mipsel/df.png data-size=503x120><img src=/posts/embeded/mipsel/df.png srcset="/posts/embeded/mipsel/df_huc9db960f5887b194616d3191f78750b9_4629_480x0_resize_box_2.png 480w, /posts/embeded/mipsel/df_huc9db960f5887b194616d3191f78750b9_4629_1024x0_resize_box_2.png 1024w" width=503 height=120 loading=lazy alt=空间占用></a><figcaption>空间占用</figcaption></figure></p></li><li><p>程序运行出错「<font color=red>-sh: ./hello: Permission denied</font>」</p><p>因为文件没有执行的权限, 执行命令</p><pre><code>chmod u+x hello
</code></pre><p>之后再执行程序即可</p></li><li><p>程序运行出错「<font color=red>line 1: syntax error: unexpected word (expecting &ldquo;)")</font>」</p><p>因为编译出来的可执行文件的指令集, 或者位数(64/32)不符合目标平台的CPU, 我的小米路由器AC2100搭载的CPU为<a class=link href=https://www.mediatek.cn/products/home-networking/mt7621 target=_blank rel=noopener>MT7621A</a>, 是一颗MIPS架构32位的CPU, 而最开始<a class=link href=https://visualstudio.microsoft.com/zh-hans/ target=_blank rel=noopener>Visual Studio</a>使用默认编译环境生成的平台是Intel x64, 所以路由器无法执行.
解决方法是在Ubuntu上安装mips交叉编译器重新编译</p><p>说一下发现过程:<br>MIPS同ARM类似是属于嵌入式CPU的一种, 由于没有接触过嵌入式Linux开发, 仅在官网CPU介绍界面看到了MIPS字样, 同时看到很多嵌入式编译提到ARM字样, 推测MIPS也有自己的编译工具, 但网上ARM教程居多, MIPS很少, 大部分MIPS都需要自己使用「buildroot」或「crosstool-NG」生成编译工具, 找了好久才找到能直接用的编译工具<code>mips-linux-gnu-gcc</code>, 但编译出来的文件还是报一样的错, 一度怀疑是位数的问题, 但是加上参数指定位数<code>mips-linux-gnu-gcc -mabi=32</code> 编译依然没有解决.</p><p>后来我从路由器中复制出来一份自带的程序<strong>zerotier-one</strong>, 用记事本打开并和我自己编译的程序对比, 显示两者都是以<strong>ELF</strong>开头的后面接二进制数据, 说明我编译出来的确实是可执行文件.</p><p><figure style=flex-grow:316;flex-basis:759px><a href=/posts/embeded/mipsel/elf.png data-size=329x104><img src=/posts/embeded/mipsel/elf.png srcset="/posts/embeded/mipsel/elf_hub34eb7eac1621353cbfdca82ef4e05c0_3363_480x0_resize_box_2.png 480w, /posts/embeded/mipsel/elf_hub34eb7eac1621353cbfdca82ef4e05c0_3363_1024x0_resize_box_2.png 1024w" width=329 height=104 loading=lazy alt=elf></a><figcaption>elf</figcaption></figure></p><p>再后来用 <code>file</code> 命令分别查看两个文件, 显示<strong>zerotier-one</strong>和我编译的有所不同.</p><p><strong>hello</strong>的file信息</p><pre><code>ELF 32-bit MSB executable, MIPS, MIPS32 rel2 version 1 (SYSV), dynamically linked, interpreter /lib/ld.so.1, BuildID[sha1].&gt; =5cffbd2c17c264eadb4b91fa4490d868de7e4e15, for GNU/Linux 3.2.0, not stripped
</code></pre><p><strong>zerotier-one</strong>的file信息</p><pre><code>ELF 32-bit LSB executable, MIPS, MIPS32 rel2 version 1 (SYSV), dynamically linked, interpreter /lib/ld-uClibc.so.0, stripped
</code></pre><p>可见最大的差别就是MSB和LSB, 查询资料后了解到是高低在前的问题, 两者的数据内容相反.</p><p>参考资料: <a class=link href=https://blog.csdn.net/qq_22279697/article/details/80508624 target=_blank rel=noopener>MSB和LSB区别</a></p><p>于是编译时加上参数 <code>mips-linux-gnu-gcc -EL</code></p><pre><code>/usr/lib/gcc-cross/mips-linux-gnu/10/../../../../mips-linux-gnu/bin/ld: /usr/lib/gcc-cross/mips-linux-gnu/10/../../../../mips-linux-gnu/lib/../lib/libgcc_s.so.1: error adding symbols: file in wrong format
collect2: error: ld returned 1 exit status
</code></pre><p>但是报错了(似乎应该是 <code>-LE</code>, 未验证), 再后来注意到 <strong>MIPS编译工具也是分为MIPS和MIPSEL的, MIPSEL编译结果是低位在前, 就是我们想要的LSB文件, 而我一开始安装的编译工具是「gcc-mips-linux-gnu」, 即生成高位在前的可执行文件</strong>, 而当我直接执行 <code>mipsel-linux-gnu-gcc</code> 会提示未安装</p><pre><code>Command 'mipsel-linux-gnu-gcc' not found, but can be installed with:
apt install gcc-mipsel-linux-gnu
</code></pre><p>我们根据提示执行
<code>apt install gcc-mipsel-linux-gnu</code>
安装后就可以使用 <code>mipsel-linux-gnu-gcc</code> 命令了</p></li><li><p>执行程序出错「<font color=red>-sh: ./hello: not found</font>」</p><p>原因是缺少运行库, 可以从别的地方复制库过来并配置环境变量啥的, 也可以简单点编译的时候加上 <code>-static</code> 参数直接把需要的库打包进程序里.<br>另外在WSL中, 所有目录以文件都位于Windows「C:\Users\用户名\AppData\Local\Packages\Ubuntu发行版号\LocalState\rootfs\」, 例如:「C:\Users\Administrator\AppData\Local\Packages\CanonicalGroupLimited.Ubuntu18.04LTS_79rhkp1fndgsc\LocalState\rootfs\」, 而编译时所需的库文件位于「usr\mipsel-linux-gnu\lib」</p><p>参考资料: <a class=link href=https://blog.csdn.net/socbis/article/details/108001336 target=_blank rel=noopener>linux 执行程序时，提示not found问题分析</a></p></li><li><p>其他探索</p><ul><li>可使用 <code>cat /proc/cpuinfo</code> 命令查看CPU信息, 可得到关键信息32, MIPS, 1004K, MT7621, 然后查找相关资料</li><li>可使用 <code>uname -a</code> 命令查看系统信息, 但是不多,</li><li>可使用 <code>cat /proc/version</code> 命令查看系统信息, 如下</li></ul><pre><code>R2100:/proc # cat /proc/version
Linux version 3.4.113 (root@fv-az19-273) (gcc version 7.4.0 (crosstool-NG 1.24.0) ) #1 SMP Wed Oct 20 17:03:44 UTC 2021
</code></pre><p>其中的 <strong>crosstool-NG 1.24.0</strong>, 是交叉编译工具, 所以这套系统应该是用这个工具编译出来的, 同理应该可以用这套工具编译自己的程序, 但网上很难找到现成的, 需要自己构建</p><ul><li>可使用 <code>readelf</code> 命令查看可执行文件信息, 查看hello的信息如下:<figure style=flex-grow:207;flex-basis:499px><a href=/posts/embeded/mipsel/readelf1.png data-size=678x326><img src=/posts/embeded/mipsel/readelf1.png srcset="/posts/embeded/mipsel/readelf1_hu6db303a8d1b0d5b981ac711e8eccf8e9_10594_480x0_resize_box_2.png 480w, /posts/embeded/mipsel/readelf1_hu6db303a8d1b0d5b981ac711e8eccf8e9_10594_1024x0_resize_box_2.png 1024w" width=678 height=326 loading=lazy alt=wol></a><figcaption>wol</figcaption></figure>而路由器中自带的程序 zerotier-one的elf信息如下<figure style=flex-grow:207;flex-basis:499px><a href=/posts/embeded/mipsel/readelf1.png data-size=678x326><img src=/posts/embeded/mipsel/readelf1.png srcset="/posts/embeded/mipsel/readelf1_hu6db303a8d1b0d5b981ac711e8eccf8e9_10594_480x0_resize_box_2.png 480w, /posts/embeded/mipsel/readelf1_hu6db303a8d1b0d5b981ac711e8eccf8e9_10594_1024x0_resize_box_2.png 1024w" width=678 height=326 loading=lazy alt=zerotier-one></a><figcaption>zerotier-one</figcaption></figure>可见一眼看上去并没有明显差别, 都是MIPS</li><li>路由器上可以执行shell脚本和curl, 但我需要发送UDP路由器上的系统无法实现, 例如 <code>/dev/udp/xxx.xxx.xxx.xxx/x</code> 路由器并不支持, 还是只能用代码</li></ul></li><li><p>最新发现<br><strong>Go语言原生支持Windows交叉编译MIPSEL</strong>, 在GO环境变量中将 <code>GOOS</code> 设置为<strong>linux</strong>, <code>GOARCH</code> 设置为<strong>mipsle</strong> (没有拼错), 就可以直接用 <code>go build</code> 命令编译出MIPS架构LSB的可执行文件</p></li></ol><h2 id=6>一点感想</h2><p>网上关于MIPS架构的资料太少了, 因为此前也没有这方面基础, 从开始到出结果可谓一波三折, 走了太多弯路, 所以这次记录下来便于以后查阅</p></section><footer class=article-footer><section class=article-tags><a href=/tags/embeded/>Embeded</a>
<a href=/tags/mipsel/>MIPSEL</a>
<a href=/tags/wsl/>WSL</a>
<a href=/tags/padavan/>Padavan</a>
<a href=/tags/linux/>Linux</a>
<a href=/tags/c/>C</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2021 -
2023 Acgnu+</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>