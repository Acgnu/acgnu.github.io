<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>.NET on Acgnu+</title><link>/tags/.net/</link><description>Recent content in .NET on Acgnu+</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Thu, 22 Aug 2024 00:50:44 +0800</lastBuildDate><atom:link href="/tags/.net/index.xml" rel="self" type="application/rss+xml"/><item><title>关于Adobe Flash失效后如何继续使用某弹播放器</title><link>/posts/hack/xtan/flashnext/</link><pubDate>Thu, 22 Aug 2024 00:50:44 +0800</pubDate><guid>/posts/hack/xtan/flashnext/</guid><description>背景 本文再续 某琴吧EXE播放器破解记录, 意在解决Adobe停止维护Flash后, 整个Flash失效导致播放器无法使用的问题.
2020年末Adobe公司停止了对Flash的维护, 随之而来的是浏览器删除了对Flash的支持, 包括Windows系统内安装的Flash也无法继续使用, 而我们获取乐谱资源需要用到Flash版的某琴吧播放器, 之前使用的是AxShockwaveFlash, 这个组件也是引用了Windows上安装的Flash, 只能寻找其他替代方案
此文章编辑于2024年8月, 实际改造在2021年5月就已完成, 因此没有早期Flash失效截图. 另外某琴吧在2023年再次更新, 用手机版APP取代了PC版播放器, 后续的乐谱播放文件变更为.ypn1 (通过前两次规律使用 yp 当前缀, 再加两位数组/字母用脚本穷举得出), 新格式只能在手机上用APP播放. 但暂不影响乐谱页的获取.
目标 使Flash版某琴吧播放器可用
分析 首先简单回顾一下破解过程, 我们先反编译了Flash版的某琴吧播放器, 然后在源码中增加了一个swfExtGetypURL方法, 此方法根据传入的乐谱ID返回乐谱资源URL, 再通过ExternalInterface.addCallback将该方法暴露给Flash容器, 我们就可以使用容器与Flash通信了. 而现在的问题是, 容器即AxShockwaveFlash组件由于Flash停止维护已经用不了了, 那么有没有什么办法能够继续运行Flash呢? 答案是有的, 我们还有另一种独立的Flash Player应用程序, 它不需要安装, 下载到电脑后双击即可运行
Adobe Flash Player 29截图
如上图所示, 启动之后界面是空白的, 因为没有运行Flash文件, 我们可以单击 文件 - 打开, 来选择一个.swf后缀的Flash文件进行播放, 例如下图是来自QQ秀的.swf文件运行效果
image-3
实际上当时下载到的最新版本为Adobe Flash Player 3x, 这些版本也受到了停止维护的影响无法使用, 直到我逐个尝试旧版之后才找到了可用的版本 29
如何传入参数?</description></item><item><title>某琴吧EXE播放器破解记录</title><link>/posts/hack/xtan/exe/</link><pubDate>Wed, 26 May 2021 00:50:44 +0800</pubDate><guid>/posts/hack/xtan/exe/</guid><description>背景 本文接另一篇文章 某琴吧Flash播放器破解记录
由于某琴吧改版正式使用exe播放器之后, 删除了所有的.ypa2资源, 导致我没有及时下载的乐谱都无法继续使用Flash播放器播放了, 忍不了, 只能破解exe播放器了
目标 破解该站的exe播放器, 使其能够免费播放VIP乐谱, 且可以完全脱机使用
开始破解 首先安装网站的乐谱播放器, 打开安装目录发现文件结构如下
image-3
其中xxxchrome.exe相当于一个浏览器, 可以访问某琴吧, 点击&amp;quot;客户端播放&amp;quot;按钮即可打开播放器, 如下图
image-2
而xxplayer.exe才是播放器, 播放器启动后, 可以从任务管理器看到新增的进程
image-1
剩下的安装文件和库文件还有配置文件, 就不介绍了.
首先播放一个免费的乐谱, 在任务管理器中查看一下xxplayer.exe的启动参数
image-4
完整的启动参数如下
&amp;quot;C:\Program Files\马赛克music\out1\马赛克player.exe&amp;quot; &amp;quot;file=http://www.马赛克.com/open_yp.php?ypid=73981&amp;amp;uid=999999999&amp;amp;token=fbf0ab24ee47bfa1cb460e41c1f61fdb&amp;amp;ypid=73981&amp;quot; 可以看到启动参数主要为
file 官网的乐谱页地址 ypid 乐谱ID uid 用户ID token 凭证 如果从xxxchrome.exe打开一个VIP乐谱, 则会显示
image-5
那么如果我不用他的xxxchrome.exe, 直接从命令行启动xxplayer.exe, 传入一个VIP乐谱ID, 会发生什么呢?
将刚才的启动参数中的ypid参数修改为一个VIP乐谱ID, 通过命令行
xxplayer.exe &amp;quot;file=http://www.马赛克.com/open_yp.php?ypid=33418&amp;amp;uid=999999999&amp;amp;token=4c6930a47090c3f04c7e9db3bf214078&amp;quot; 启动xxplayer.exe之后如下
image-6</description></item><item><title>某琴吧Flash播放器破解记录</title><link>/posts/hack/xtan/flash/</link><pubDate>Tue, 25 May 2021 00:50:44 +0800</pubDate><guid>/posts/hack/xtan/flash/</guid><description>背景 2019年的某月, 某琴吧将越来越多的谱子改为vip收费谱, 遂于网上寻找Chrome插件实现白嫖.
同年, 得知Adobe公司将于2020年年末彻底停用Flash, 遂产生破解其Flash播放器并本地化的想法.
目标 破解该站的Flash播放器, 使其能够免费下载并播放VIP乐谱, 并将乐谱保存至本地硬盘, 同时使播放器可以脱离浏览器且可以脱机使用
网站乐谱页 image-1
开始破解 首先通过Chrome的调试控制台Network面板, 跟踪进入乐谱页的网络请求如下
进入乐谱页面, 网站向服务端请求 player.swf, 该 .swf 文件即为乐谱播放器 浏览器加载 player.swf , 播放器向服务端请求乐谱的第一页作为预览图, 显示在播放器中 点击播放按钮时, 播放器请求 Sounds.swf, 播放器请求接口 /flash_get_yp_info.php 获取乐谱详细信息, 包括谱名称, 页数, 作者, 余下的乐谱页资源地址, 播放文件地址 播放器下载并载入余下的 .png 格式乐谱图片, 并加载 .ypa2 格式的播放文件, 即可开始播放 由于文章编辑于2021年5月, 该网站已经改版移除了Flash版本播放器, 因此当时调用的服务器接口没有被记录下来, 文章没有该部分请求的截图
基本过程已经明确了, 而所有的请求接口中, 只有第四步的/flash_get_yp_info.php是需要对入参sccode, r1, r2, 进行校验, 那我只需要反编译出播放器的源码, 再根据代码仿写一个凭证生成的算法, 不就可以调用接口并得到资源地址了?
首先要实现下载乐谱图片以及播放文件, 多番对比后选用开源且免费的 jpexs-decompiler, 顺利反编译出player.swf代码, 用IDEA新建为Flex项目打开, 再百度其中的一些package名称, 发现代码可基于 flex_sdk_3.</description></item></channel></rss>